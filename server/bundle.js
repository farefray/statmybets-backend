!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=80)}([function(e,t,n){"use strict";(function(t){var r=n(6),i=n(10),o=n(2),s=n(8),a=n(14);global.rootPath=r.normalize(r.join(t,"..","..")),console.log("process.argv: "+process.argv);var u=void 0;u=process.argv.length>0?process.argv[1]:process.cwd(),global.rootPath=r.normalize(r.join(r.dirname(u),"..")),console.log("Application root path: "+global.rootPath),e.exports={isDevMode:function(){return!process.env.NODE_ENV||"development"===process.env.NODE_ENV},isProductionMode:function(){return"production"===process.env.NODE_ENV},isTestMode:function(){return"test"===process.env.NODE_ENV}};var c={},l=r.join(global.rootPath,"config.js");try{if(!i.existsSync(l)){console.warn(s.yellow.bold("External production configuration not found!. Create a default `config.js` file..."));var d=void 0;d=n(95),o.templateSettings.interpolate=/{{([\s\S]+?)}}/g;var f=o.template(d),p={hashSecret:a(),sessionSecret:a()};i.writeFileSync(l,f(p)),console.warn(s.green.bold("The `config.js` file created! Please update the settings in the file!"))}c=n(99)}catch(e){console.warn(s.red.bold("\r\n==============================================")),console.warn(s.red.bold("  Unable to load external `config.js` file!")),console.warn(s.red.bold(" ",e)),console.warn(s.red.bold("==============================================\r\n")),process.exit(1)}var m=n(65),v={};e.exports.isTestMode()?(console.log("Load test config..."),v=n(67),c={}):e.exports.isProductionMode()&&(console.log("Load production config..."),v=n(66)),e.exports=o.defaultsDeep(c,v,m,e.exports)}).call(t,"server/config")},function(e,t,n){"use strict";var r=n(140),i=n(6),o=n(10),s=n(43),a=n(0),u=[];if(u.push(new r.transports.Console({level:a.logging.console.level,colorize:!0,prettyPrint:!0,handleExceptions:"production"===process.env.NODE_ENV})),a.logging.logentries.enabled&&a.logging.logentries.token){console.log("Logentries log transport enabled!");n(120);u.push(new r.transports.Logentries({level:"debug",token:a.logging.logentries.token}))}if(a.logging.papertrail.enabled){console.log("Papertrail log transport enabled!"),n(146).Papertrail;var c=new r.transports.Papertrail(a.logging.papertrail);u.push(c)}if(a.logging.file.enabled){var l=a.logging.file.path;o.existsSync(l)||s(l),u.push(new(n(141))({filename:i.join(l,"server.log"),level:a.logging.file.level||"info",timestamp:!0,json:a.logging.file.json||!1,handleExceptions:!0})),a.logging.file.exceptionFile&&u.push(new r.transports.File({filename:i.join(l,"exceptions.log"),level:"error",timestamp:!0,json:a.logging.file.json||!1,prettyPrint:!0,handleExceptions:!0,humanReadableUnhandledException:!0}))}var d=new r.Logger({level:"debug",transports:u,exitOnError:!1});if(a.logging.loggly.enabled&&a.logging.loggly.token){console.log("Loggly log transport enabled!");n(143);d.add(r.transports.Loggly,{inputToken:a.logging.loggly.token,subdomain:a.logging.loggly.subdomain,tags:["vem-server"],json:!0})}if(a.logging.logsene.enabled&&a.logging.logsene.token){console.log("Logsene log transport enabled!");var f=n(144);d.add(f,{type:"vem-server",token:a.logging.logsene.token})}if(a.logging.logzio.enabled&&a.logging.logzio.token){console.log("Logz.io log transport enabled!");var p=n(145);d.add(p,{token:a.logging.logzio.token})}if(a.logging.graylog.enabled){console.log("Graylog log transport enabled! Servers: "+JSON.stringify(a.logging.graylog.servers));var m=n(142);d.add(m,{name:"Graylog",level:"debug",graylog:{servers:a.logging.graylog.servers,facility:"vem"}})}e.exports=d},function(e,t){e.exports=require("lodash")},function(e,t,n){"use strict";var r=(n(0),n(1),n(4)),i=(n(10),n(6),n(2),n(24)),o=n(101),s=(n(15),n(11)),a=s.Schema,u=n(20)("users"),c=n(19),l={timestamps:!0,toObject:{virtuals:!0},toJSON:{virtuals:!0}},d=function(e){return"local"!==this.provider&&!this.updated||e.length},f=function(e){return"local"!==this.provider||e&&e.length>=6},p=new a({fullName:{type:String,trim:!0,default:"",validate:[d,"Please fill in your full name"]},email:{type:String,trim:!0,unique:!0,index:!0,lowercase:!0,default:"",validate:[d,"Please fill in your email"],match:[/.+\@.+\..+/,"Please fill a valid email address"]},username:{type:String,unique:!0,index:!0,lowercase:!0,required:"Please fill in a username",trim:!0,match:[/^[\w][\w\-\._\@]*[\w]$/,"Please fill a valid username"]},password:{type:String,default:"",validate:[f,"Password should be longer"]},passwordLess:{type:Boolean,default:!1},passwordLessToken:{type:String},provider:{type:String,default:"local"},profile:{name:{type:String},gender:{type:String},picture:{type:String},location:{type:String}},socialLinks:{facebook:{type:String,unique:!0,sparse:!0},twitter:{type:String,unique:!0,sparse:!0},google:{type:String,unique:!0,sparse:!0},github:{type:String,unique:!0,sparse:!0}},roles:{type:[{type:String,enum:[r.ROLE_ADMIN,r.ROLE_USER,r.ROLE_GUEST]}],default:[r.ROLE_USER]},resetPasswordToken:String,resetPasswordExpires:Date,verified:{type:Boolean,default:!1},verifyToken:{type:String},apiKey:{type:String,unique:!0,index:!0,sparse:!0},lastLogin:{type:Date},locale:{type:String},status:{type:Number,default:1},metadata:{}},l);p.virtual("code").get(function(){return this.encodeID()}),p.plugin(c.plugin,{model:"User",startAt:1}),p.pre("save",function(e){var t=this;if(!t.isModified("password"))return e();o.genSalt(10,function(n,r){o.hash(t.password,r,null,function(n,r){t.password=r,e()})})}),p.methods.comparePassword=function(e,t){o.compare(e,this.password,function(e,n){t(e,n)})},p.virtual("avatar").get(function(){return this.profile&&this.profile.picture?this.profile.picture:this.email?"https://gravatar.com/avatar/"+i.createHash("md5").update(this.email).digest("hex")+"?s=64&d=wavatar":"https://gravatar.com/avatar/?s=64&d=wavatar"}),p.methods.encodeID=function(){return u.encodeHex(this._id)},p.methods.decodeID=function(e){return u.decodeHex(e)};var m=s.model("User",p);e.exports=m},function(e,t,n){"use strict";var r={};r.append=function(e,t){e.forEach(function(e){var n=e.toUpperCase();t&&(n=t+"_"+n),r[n]=e})},r.append(["admin","user","guest"],"ROLE"),r.append(["admin","owner","loggedIn","public"],"PERM"),r.append(["VALIDATION_ERROR","INVALID_CODE","MODEL_NOT_FOUND","ONLY_OWNER_CAN_EDIT_AND_DELETE"],"ERR"),e.exports=r},function(e,t){e.exports=require("passport")},function(e,t){e.exports=require("path")},function(e,t,n){"use strict";(function(t){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(1),u=(n(0),n(107).EventEmitter),c=n(6),l=(n(10),n(135),n(2)),d=n(8),f=n(18),p=(n(4),n(78)),m=n(9),v=n(12),h=n(109),g=(n(103),n(111).GraphQLScalarType,n(92).Kind),y=n(79),E=function(e){function u(){r(this,u);var e=i(this,(u.__proto__||Object.getPrototypeOf(u)).call(this));return e.setMaxListeners(0),e.app=null,e.db=null,e.services={},e}return o(u,e),s(u,[{key:"loadServices",value:function(e,r){var i=this;i.app=e,i.db=r;var o=function(t){var n=new y(t,e,r);i.services[n.name]=n};a.info(""),a.info(d.bold("Search built-in services..."));var s=n(98);s&&s.keys().map(function(e){a.info("  Load",c.relative(c.join(t,"..","services"),e),"service..."),o(s(e))}),a.info(""),a.info(d.bold("Search applogic services..."));var u=n(96);u&&u.keys().map(function(e){a.info("  Load",c.relative(c.join(t,"..","applogic","modules"),e),"service..."),o(u(e))}),l.forIn(i.services,function(e){l.isFunction(e.$schema.init)&&e.$schema.init.call(e,p.CreateToServiceInit(e))})}},{key:"registerRoutes",value:function(e){var t=this;l.forIn(this.services,function(n,r){if(!1!==n.$settings.rest&&n.actions){var i=f.Router();i.use(m.tryAuthenticateWithApiKey);var o=n.$settings.idParamName||"id",s=[];l.forIn(n.actions,function(r,u){var c=r.settings;if(c.handler=r,!l.isFunction(c.handler))throw new Error("Missing handler function in '"+u+"' action in '"+n.name+"' service!");var d=function(r,i){var o=p.CreateFromREST(n,c,e,r,i);a.debug("Request via REST '"+n.namespace+"/"+c.name+"' (ID: "+o.id+")",o.params),console.time("REST request"),t.emit("request",o);n.getCacheKey(c.name,o.params);Promise.resolve().then(function(){return o.resolveModel()}).then(function(){return o.checkPermission()}).then(function(){return c.handler(o)}).then(function(e){i.append("Request-Id",o.id),v.json(i,e)}).catch(function(e){a.error(e),v.json(i,null,e)}).then(function(){t.emit("response",o),console.timeEnd("REST request")})};switch(i.get("/"+u,d),i.post("/"+u,d),i.get("/:"+o+"/"+u,d),i.post("/:"+o+"/"+u,d),u){case"find":i.get("/",d);break;case"get":s.push({method:"get",path:"/:"+o,handler:d});break;case"create":s.push({method:"post",path:"/:"+o,handler:d}),i.post("/",d);break;case"update":s.push({method:"put",path:"/:"+o,handler:d}),s.push({method:"patch",path:"/:"+o,handler:d}),i.put("/",d),i.patch("/",d);break;case"remove":s.push({method:"delete",path:"/:"+o,handler:d}),i.delete("/",d)}}),s.forEach(function(e){i[e.method](e.path,e.handler)}),e.use("/api/"+n.namespace,i),n.version&&e.use("/api/v"+n.version+"/"+n.namespace,i)}})}},{key:"registerSockets",value:function(e,t){var n=this;l.forIn(this.services,function(r,i){if(!1!==r.ws){r.socket=r.socket||{};var o=void 0;o=r.socket.nsp&&"/"!==r.socket.nsp?t.addNameSpace(r.socket.nsp,r.role):e,r.io=o,o.on("connection",function(e){l.isFunction(r.socket.afterConnection)&&r.socket.afterConnection.call(r,e,o),l.forIn(r.actions,function(t,i){var o=t.settings;if(o.handler=t,!l.isFunction(o.handler))throw new Error("Missing handler function in '"+i+"' action in '"+r.name+"' service!");var s="/"+r.namespace+"/"+o.name,u=function(t,i){var s=p.CreateFromSocket(r,o,n.app,e,t);a.debug("Request via WebSocket '"+r.namespace+"/"+o.name+"'",s.params),console.time("SOCKET request"),n.emit("request",s);r.getCacheKey(o.name,s.params);Promise.resolve().then(function(){return s.resolveModel()}).then(function(){return s.checkPermission()}).then(function(){return o.handler(s)}).then(function(e){l.isFunction(i)&&i(v.json(null,e))}).catch(function(e){a.error(e),l.isFunction(i)&&i(v.json(null,null,e))}).then(function(){n.emit("response",s),console.timeEnd("SOCKET request")})};e.on(s,u),r.version&&e.on("/v"+r.version+s,u)})})}})}},{key:"registerGraphQLSchema",value:function(){var e=this,t={queries:[],types:[],mutations:[],resolvers:[]};if(l.forIn(this.services,function(n,r){if(!1!==n.$settings.graphql&&l.isObject(n.$schema.graphql)){var i=n.$schema.graphql;i.resolvers=i.resolvers||{};var o=function(t){l.forIn(t,function(r,i){if(l.isString(r)&&n.actions[r]){var o=function(t,o,s){var u=n.actions[r],c=u.settings;if(c.handler=u,!l.isFunction(c.handler))throw new Error("Missing handler function in '"+i+"' action in '"+n.name+"' service!");var d=p.CreateFromGraphQL(n,c,t,o,s);a.debug("Request via GraphQL",d.params,s.query),console.time("GRAPHQL request"),e.emit("request",d);n.getCacheKey(c.name,d.params);return Promise.resolve().then(function(){return d.resolveModel()}).then(function(){return d.checkPermission()}).then(function(){return c.handler(d)}).catch(function(e){throw a.error(e),e}).then(function(t){return e.emit("response",d),console.timeEnd("GRAPHQL request"),t})};t[i]=o}})};i.resolvers.Query&&o(i.resolvers.Query),i.resolvers.Mutation&&o(i.resolvers.Mutation),t.queries.push(i.query),t.types.push(i.types),t.mutations.push(i.mutation),t.resolvers.push(i.resolvers)}}),0==t.queries.length)return null;var n="\n\n\t\t\tscalar Timestamp\n\n\t\t\ttype Query {\n\t\t\t\t"+t.queries.join("\n")+"\n\t\t\t}\n\n\t\t\t"+t.types.join("\n")+"\n\n\t\t\ttype Mutation {\n\t\t\t\t"+t.mutations.join("\n")+"\n\t\t\t}\n\n\t\t\tschema {\n\t\t\t\tquery: Query\n\t\t\t\tmutation: Mutation\n\t\t\t}\n\t\t";return{schema:[n],resolvers:function(e){return t.resolvers.forEach(function(t){e=l.merge(e,t)}),e}({Timestamp:{__parseValue:function(e){return new Date(e)},__serialize:function(e){return e.getTime()},__parseLiteral:function(e){return e.kind===g.INT?parseInt(e.value,10):null}}})}}},{key:"get",value:function(e){return this.services[e]}},{key:"printServicesInfo",value:function(){h(this.app)}}]),u}(u);e.exports=new E}).call(t,"server/core")},function(e,t){e.exports=require("chalk")},function(e,t,n){"use strict";var r=n(1),i=n(0),o=n(5),s=n(3);e.exports.isAuthenticated=function(e,t,n){return e.isAuthenticated()?n():t.sendStatus(401)},e.exports.tryAuthenticateWithApiKey=function(e,t,n){e.isAuthenticated()?n():e.headers.apikey||e.query.apikey||e.body.apikey?o.authenticate("localapikey",function(t,i,o){i?e.login(i,function(e){n()}):(r.warn("Apikey error:",o),n())})(e,t,n):n()},e.exports.isAuthenticatedOrApiKey=function(e,t,n){return e.isAuthenticated()?n():e.headers.apikey||e.query.apikey||e.body.apikey?void o.authenticate("localapikey",function(r,i,o){return r?t.sendStatus(500):i?void e.login(i,function(e){return e?t.sendStatus(500):n()}):t.status(401).send(o.message||"")})(e,t,n):t.sendStatus(401)},e.exports.hasRole=function(t){if(!t)throw new Error("Required role needs to be set");return function(n,r,i){return e.exports.isAuthenticated(n,r,function(){n.user&&n.user.roles&&-1!==n.user.roles.indexOf(t)?i():r.sendStatus(403)})}},e.exports.hasAdminRole=function(){return e.exports.hasRole("admin")},e.exports.linkToSocialAccount=function(e){var t=e.req,n=(e.accessToken,e.refreshToken,e.profile),r=e.done,o=e.provider,a=(e.username,e.email),u=e.userData;if(t.user){var c={};c["socialLinks."+o]=n.id,s.findOne(c,function(e,i){if(i)return i._id!=t.user._id?(t.flash("error",{msg:t.t("SocialIDLinkedToOtherAccount")}),r(e)):r(e,i);s.findById(t.user.id,function(e,i){i.socialLinks=i.socialLinks||{},i.socialLinks[o]=n.id,i.profile=i.profile||{},i.profile.name=i.profile.name||u.name,i.profile.gender=i.profile.gender||u.gender,i.profile.picture=i.profile.picture||u.picture,i.profile.location=i.profile.location||u.location,i.save(function(e){t.flash("info",{msg:t.t("AccountHasBeenLinked")}),r(e,i)})})})}else{var l={};l["socialLinks."+o]=n.id,s.findOne(l,function(e,c){return c?1!==c.status?(t.flash("error",{msg:t.t("UserDisabledOrDeleted")}),r()):r(e,c):a?void s.findOne({email:a},function(e,c){if(c){if(1!==c.status)return t.flash("error",{msg:t.t("UserDisabledOrDeleted")}),r();var l=c;return l.socialLinks=l.socialLinks||{},l.socialLinks[o]=n.id,l.profile=l.profile||{},l.profile.name=l.profile.name||u.name,l.profile.gender=l.profile.gender||u.gender,l.profile.picture=l.profile.picture||u.picture,l.profile.location=l.profile.location||u.location,void l.save(function(e){t.flash("info",{msg:t.t("AccountHasBeenLinked")}),r(e,l)})}if(!0===i.features.disableSignUp)return t.flash("error",{msg:t.t("SignUpDisabledPleaseLogin")}),r();var d=new s;d.fullName=u.name,d.email=a,d.username=a,d.provider=o,d.verified=!0,d.passwordLess=!0,d.socialLinks={},d.socialLinks[o]=n.id,d.profile=u,d.save(function(e){r(e,d)})}):(t.flash("error",{msg:t.t("SocialMissingEmailAddress")}),r())})}}},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("mongoose")},function(e,t,n){"use strict";e.exports={BAD_REQUEST:{status:400,type:"BAD_REQUEST",message:"Invalid request"},UNAUTHORIZED:{status:401,type:"UNAUTHORIZED",message:"Unauthorized. Please login first!"},REQUEST_FAILED:{status:402,type:"REQUEST_FAILED",message:"Request failed!"},FORBIDDEN:{status:403,type:"FORBIDDEN",message:"You have not enough permission for this resource!"},NOT_FOUND:{status:404,type:"NOT_FOUND",message:"Not found!"},TOO_MANY_REQUEST:{status:429,type:"TOO_MANY_REQUEST",message:"Too many request!"},SERVER_ERROR:{status:500,type:"SERVER_ERROR",message:"Server error"},NOT_IMPLEMENTED:{status:501,type:"NOT_IMPLEMENTED",message:"This resource is not implemented!"},json:function(e,t,n,r){var i={};return n?(i.error=n,i.status=n.status||500,r&&(i.error.message=r.message||r),i.data=t,e?e.status(i.status).json(i):i):(i.status=200,i.data=t,e?e.json(i):i)}}},function(e,t,n){"use strict";var r=n(1),i=n(0),o=(n(6),n(10),n(42)),s=n(2),a=n(38),u=n(5),c=n(133),l=n(39),d=n(37)(l),f=void 0,p={IO:null,mongoStore:null,namespaces:{},userSockets:[],init:function(e,t){p.mongoStore=new d({mongooseConnection:t.connection,collection:i.sessions.collection,autoReconnect:!0});var s=o.createServer(e),a=c(s);return e.io=p,p.IO=a,p.initNameSpace("/",a,p.mongoStore),a.on("connection",function(e){e.on("welcome",function(t){r.info("Incoming welcome message from "+e.request.user.username+":",t)})}),n(7).registerSockets(a,p),s},addNameSpace:function(e,t){var n=p.namespaces[e];return null==n&&(n=p.IO.of(e),p.initNameSpace(e,n,p.mongoStore,t)),n},initNameSpace:function(e,t,o,s){t.use(function(t,n){a(i.sessionSecret)(t.request,{},function(a){var c=t.request.signedCookies?t.request.signedCookies[i.sessions.name]:void 0;if(!c)return r.warn("sessionId was not found in socket.request"),n(new Error("sessionId was not found in socket.request"),!1);o.get(c,function(i,a){return i?n(i,!1):a?(t.request.session=a,a.socket=t.id,o.set(c,a),void u.initialize()(t.request,{},function(){u.session()(t.request,{},function(){if(t.request.user){var i=t.request.user;s?i.roles&&-1!==i.roles.indexOf(s)?n(null,!0):(r.warn("Websocket user has no access to this namespace '"+e+"'!",i.username),n(new Error("You have NO access to this namespace '"+e+"'!"),!1)):n(null,!0)}else r.warn("Websocket user is not authenticated!"),n(new Error("User is not authenticated! Please login first!"),!1)})})):n(new Error("session was not found for "+c),!1)})})}),t.on("connection",function(e){f||(f=n(7)),f.emit("socket:connect",e),p.addOnlineUser(e),r.debug("WS client connected to namespace "+(t.name||"root")+"! User: "+e.request.user.username),e.on("disconnect",function(){f.emit("socket:connect",e),p.removeSocket(e),r.debug("WS client disconnected from namespace "+(t.name||"root")+"!")})}),p.namespaces[e]=t},nsEmit:function(e,t,n){if(p.namespaces[e])return p.namespaces[e].emit(t,n),!0},addOnlineUser:function(e){p.removeOnlineUser(e),p.userSockets.push(e)},removeSocket:function(e){s.remove(p.userSockets,function(t){return t==e})},removeOnlineUser:function(e){s.remove(p.userSockets,function(t){return t.request.user._id==e.request.user._id})}};e.exports=p},function(e,t,n){"use strict";var r=n(136),i=new r(256,r.BASE62);e.exports=function(){return i.generate()}},function(e,t,n){"use strict";var r=n(1),i=n(0),o=n(8),s=n(11),a=n(19);e.exports=function(){var e=void 0;return r.info(),s.Promise=global.Promise,1!==s.connection.readyState?(r.info("Connecting to Mongo "+i.db.uri+"..."),e=s.connect(i.db.uri,i.db.options,function(e){if(e)return r.error("Could not connect to MongoDB!"),r.error(e);s.set("debug",i.isDevMode())}),s.connection.on("error",function(e){return"ETIMEDOUT"===e.message.code?(r.warn("Mongo connection timeout!",e),void setTimeout(function(){s.connect(i.db.uri,i.db.options)},1e3)):(r.error("Could not connect to MongoDB!"),r.error(e))}),a.initialize(e),s.connection.once("open",function(){r.info(o.yellow.bold("Mongo DB connected.")),r.info(),i.isTestMode()?(r.warn("Drop test database..."),n(29)()):i.isProduction||n(29)()})):(r.info("Mongo already connected."),e=s),e}},function(e,t){e.exports=require("moment")},function(e,t,n){"use strict";var r=n(1),i=n(0),o=n(8),s=n(119),a=void 0;i.redis.enabled&&(a=new s(i.redis.uri),a.on("connect",function(e){r.info(o.green.bold("Redis client connected!"))}),a.on("error",function(e){r.error(e)}),i.isDevMode()&&a.monitor(function(e,t){r.debug("Redis entering monitoring mode..."),t.on("monitor",function(e,t,n,i){r.debug("REDIS: ",t)})})),e.exports=a},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("mongoose-auto-increment")},function(e,t,n){"use strict";var r=n(113),i=n(0);e.exports=function(e,t){return new r(e+i.hashSecret,t||10)}},function(e,t,n){"use strict";function r(e,t,n,o,s,a){var u=n;if(!u&&t&&t.length>0){var c=t[0];u=c&&c.loc&&c.loc.source}var l=o;!l&&t&&(l=t.filter(function(e){return Boolean(e.loc)}).map(function(e){return e.loc.start})),l&&0===l.length&&(l=void 0);var d=void 0,f=u;f&&l&&(d=l.map(function(e){return(0,i.getLocation)(f,e)})),Object.defineProperties(this,{message:{value:e,enumerable:!0,writable:!0},locations:{value:d||void 0,enumerable:!0},path:{value:s||void 0,enumerable:!0},nodes:{value:t||void 0},source:{value:u||void 0},positions:{value:l||void 0},originalError:{value:a}}),a&&a.stack?Object.defineProperty(this,"stack",{value:a.stack,writable:!0,configurable:!0}):Error.captureStackTrace?Error.captureStackTrace(this,r):Object.defineProperty(this,"stack",{value:Error().stack,writable:!0,configurable:!0})}Object.defineProperty(t,"__esModule",{value:!0}),t.GraphQLError=r;var i=n(22);r.prototype=Object.create(Error.prototype,{constructor:{value:r},name:{value:"GraphQLError"}})},function(e,t,n){"use strict";function r(e,t){for(var n=/\r\n|[\n\r]/g,r=1,i=t+1,o=void 0;(o=n.exec(e.body))&&o.index<t;)r+=1,i=t+1-(o.index+o[0].length);return{line:r,column:i}}Object.defineProperty(t,"__esModule",{value:!0}),t.getLocation=r},function(e,t){e.exports={name:"StatsBackend",version:"0.9.0",title:"Express-Mongo backend",description:"Express NodeJS application server boilerplate with Mongo",main:"server/index.js",scripts:{build:"webpack --progress --colors --config build/webpack.prod.config.js","build:server":"webpack --progress --colors --config build/webpack.server.config.js",dev:"cross-env NODE_ENV=development nodemon --debug","docker-dev":"cross-env NODE_ENV=development MONGO_URI=mongodb://mongo/ nodemon --debug",start:"cross-env NODE_ENV=production node server/index.js","start:bundle":"cross-env NODE_ENV=production node server/bundle.js","start:cluster":"cross-env NODE_ENV=production node cluster.js","test:unit":"cross-env NODE_ENV=test mocha --require babel-core/register --reporter spec tests/unit",ci:'cross-env NODE_ENV=test nodemon --exec "mocha --require babel-core/register --reporter dot --watch tests/unit" tests/unit',lint:"eslint --ext=.js server","lint:fix":"eslint --fix --ext=.js server","snyk-protect":"snyk protect",typings:"typings install"},repository:{type:"git",url:"git@github.com:farefray/my-backend-for-v2.git"},keywords:[],config:{dbName:"boilerplate"},author:"Icebob && Farefray",license:"MIT",dependencies:{agenda:"0.9.1",async:"2.4.1","bcrypt-nodejs":"0.0.3","body-parser":"1.17.2",chalk:"1.1.3","cli-table2":"0.2.0",clui:"0.3.1",compression:"1.6.2","connect-mongo":"1.3.2","cookie-parser":"1.4.3",csurf:"1.9.0",express:"4.15.3","express-flash":"0.0.2","express-list-endpoints":"3.0.0","express-session":"1.15.3","express-status-monitor":"0.1.9","express-validator":"3.2.0",fakerator:"0.3.0",glob:"7.1.2",graphql:"0.10.0","graphql-server-express":"0.7.2","graphql-subscriptions":"0.3.1","graphql-tools":"0.11.0",hashids:"1.1.1",helmet:"3.6.1","helmet-crossdomain":"0.1.0",i18next:"8.3.0","i18next-express-middleware":"1.0.5","i18next-node-fs-backend":"1.0.0",ioredis:"3.0.0",le_node:"1.7.0",lodash:"4.17.4","method-override":"2.3.9",mkdirp:"0.5.1",moment:"2.18.1",mongoose:"4.10.2","mongoose-auto-increment":"5.0.1",morgan:"1.8.2",netjet:"1.1.3",nodemailer:"4.0.1","nodemailer-html-to-text":"2.1.0","nodemailer-mailgun-transport":"1.3.5","nodemailer-sendgrid-transport":"0.2.0","object-hash":"1.1.8",passport:"0.3.2","passport-facebook":"2.1.1","passport-github":"1.1.0","passport-google-oauth":"1.0.0","passport-local":"1.0.0","passport-localapikey-update":"0.5.0","passport-twitter":"1.0.4","pretty-bytes":"4.0.2",pug:"2.0.0-beta6","require-webpack-compat":"3.0.0","serve-favicon":"2.4.3",slug:"0.9.1",snyk:"^1.30.1","socket.io":"2.0.2","socket.io-client":"2.0.2","uuid-token-generator":"1.0.0",winston:"2.3.1","winston-daily-rotate-file":"1.4.6","winston-graylog2":"0.6.0","winston-loggly-bulk":"2.0.0","winston-logsene":"1.2.1","winston-logzio":"1.0.3","winston-papertrail":"1.0.5"},devDependencies:{"apollo-client":"1.2.2",autoprefixer:"7.1.1",babel:"6.23.0","babel-core":"6.24.1","babel-loader":"7.0.0","babel-plugin-transform-runtime":"6.23.0","babel-preset-es2015":"6.24.1","babel-preset-stage-0":"6.24.1","babel-runtime":"6.23.0",chai:"3.5.0",chromedriver:"2.29.0","cross-env":"^5.0.0","cross-spawn":"5.1.0",del:"2.2.2","es6-promise":"4.1.0",eslint:"3.19.0","eslint-friendly-formatter":"3.0.0","eslint-loader":"1.7.1","eslint-plugin-html":"2.0.3","extract-text-webpack-plugin":"2.1.0","file-loader":"0.11.1","graphql-tag":"2.1.0","i18next-browser-languagedetector":"1.0.1","i18next-xhr-backend":"1.4.1","json-loader":"0.5.4",marked:"0.3.6",mocha:"3.4.2",nodemon:"^1.11.0","postcss-loader":"2.0.5",precss:"1.4.0","raw-loader":"0.5.1",request:"2.81.0",sinon:"2.3.1","sinon-chai":"2.10.0","stats-webpack-plugin":"0.6.0","style-loader":"0.18.1",typings:"2.1.1","url-loader":"0.5.8",uuid:"3.0.1",webpack:"2.6.1","webpack-dev-middleware":"1.10.2","webpack-dev-server":"2.4.5","webpack-hot-middleware":"2.18.0","webpack-merge":"4.1.0"},snyk:!0}},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("webpack")},function(e,t,n){"use strict";var r=n(1),i=n(0),o=n(16),s=n(8),a=n(100),u=n(3),c=new a({db:{address:i.db.uri,collection:"agendaJobs"},processEvery:i.agendaTimer||"one minute"});c.on("fail",function(e,t){return r.error("Job failed with error: "+e.message)}),c.define("removeUnverifiedAccounts",function(e,t){r.debug("Running 'removeUnverifiedAccounts' process...");try{u.remove({createdAt:{$lte:o().subtract(1,"day").toDate()},verified:!1},function(e,n){n>0&&r.warn(s.bold.red(n+" unverified and expired account removed!")),t()})}catch(e){return r.error("Job running exception!"),r.error(e),t(e)}}),c.on("ready",function(){i.isTestMode()||(c.every("8 hours","removeUnverifiedAccounts"),c.start(),r.info(s.yellow("Agenda started!")))}),e.exports=c},function(e,t,n){"use strict";var r=(n(0),n(1),n(15),n(11)),i=r.Schema,o=n(20)("devices"),s=n(19),a={timestamps:!0,toObject:{virtuals:!0},toJSON:{virtuals:!0}},u=new i({address:{type:String,trim:!0},type:{type:String,trim:!0},name:{type:String,trim:!0},description:{type:String,trim:!0,default:""},status:{type:Number,default:1},lastCommunication:{type:Date,default:Date.now},metadata:{}},a);u.virtual("code").get(function(){return this.encodeID()}),u.plugin(s.plugin,{model:"Device",startAt:1}),u.methods.encodeID=function(){return o.encodeHex(this._id)},u.methods.decodeID=function(e){return o.decodeHex(e)};var c=r.model("Device",u);e.exports=c},function(e,t,n){"use strict";var r=(n(0),n(1),n(2),n(15),n(11)),i=r.Schema,o=n(20)("posts"),s=n(19),a={timestamps:!0,toObject:{virtuals:!0},toJSON:{virtuals:!0}},u=new i({title:{type:String,trim:!0},content:{type:String,trim:!0},author:{type:Number,required:"Please fill in an author ID",ref:"User"},views:{type:Number,default:0},voters:[{type:Number,ref:"User"}],votes:{type:Number,default:0},editedAt:{type:Date},metadata:{}},a);u.virtual("code").get(function(){return this.encodeID()}),u.plugin(s.plugin,{model:"Post",startAt:1}),u.methods.encodeID=function(){return o.encodeHex(this._id)},u.methods.decodeID=function(e){return o.decodeHex(e)};var c=r.model("Post",u);e.exports=c},function(e,t,n){"use strict";var r=n(1),i=n(0),o=n(4),s=n(2),a=n(14),u=n(40)(),c=n(3);e.exports=function(){return c.find({}).exec().then(function(e){if(0===e.length){r.warn("Load default Users to DB...");var t=[],n=new c({fullName:"Administrator",email:"admin@boilerplate-app.com",username:"admin",password:"admin1234",provider:"local",roles:[o.ROLE_ADMIN,o.ROLE_USER],verified:!0});t.push(n.save());var l=new c({fullName:"Test User",email:"test@boilerplate-app.com",username:"test",password:"test1234",provider:"local",roles:[o.ROLE_USER],verified:!0,apiKey:a()});return t.push(l.save()),Promise.all(t).then(function(){if(!i.isProductionMode())return Promise.all(s.times(10,function(){var e=u.entity.user(),n=new c({fullName:e.firstName+" "+e.lastName,email:e.email,username:e.userName,password:e.password,provider:"local",roles:[o.ROLE_USER],verified:!0});t.push(n.save())}))}).then(function(){r.warn("Default users created!")})}}).catch(function(e){r.error(e)}).then(function(){return n(55)()}).then(function(){r.debug("Seeding done!")})}},function(e,t,n){"use strict";var r=n(0),i=n(1),o=n(44),s=n(45).htmlToText;e.exports={send:function(e,t,a,u){i.info("Sending email to "+e+" with subject "+t+"..."),i.debug("Deprecated! libs/mailer is deprecated. Use Service.get('mailer') instead!");var c={from:r.mailer.from,to:e,subject:t,html:a},l=void 0;if("smtp"==r.mailer.transport)l=o.createTransport(r.mailer.smtp);else if("mailgun"==r.mailer.transport){var d=n(46);l=o.createTransport(d({auth:{api_key:r.mailer.mailgun.apiKey,domain:r.mailer.mailgun.domain}}))}else if("sendgrid"==r.mailer.transport){var f=n(47);l=o.createTransport(f({auth:{api_key:r.mailer.sendgrid.apiKey}}))}l?(l.use("compile",s()),l.sendMail(c,function(e,t){e?i.warn("Unable to send email: ",e):i.info("Email message sent.",t.response),u&&u(e,t)})):i.warn("Unable to send email! Invalid mailer transport: "+r.mailer.transport)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(21);Object.defineProperty(t,"GraphQLError",{enumerable:!0,get:function(){return r.GraphQLError}});var i=n(90);Object.defineProperty(t,"syntaxError",{enumerable:!0,get:function(){return i.syntaxError}});var o=n(89);Object.defineProperty(t,"locatedError",{enumerable:!0,get:function(){return o.locatedError}});var s=n(88);Object.defineProperty(t,"formatError",{enumerable:!0,get:function(){return s.formatError}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.NAME="Name",t.DOCUMENT="Document",t.OPERATION_DEFINITION="OperationDefinition",t.VARIABLE_DEFINITION="VariableDefinition",t.VARIABLE="Variable",t.SELECTION_SET="SelectionSet",t.FIELD="Field",t.ARGUMENT="Argument",t.FRAGMENT_SPREAD="FragmentSpread",t.INLINE_FRAGMENT="InlineFragment",t.FRAGMENT_DEFINITION="FragmentDefinition",t.INT="IntValue",t.FLOAT="FloatValue",t.STRING="StringValue",t.BOOLEAN="BooleanValue",t.NULL="NullValue",t.ENUM="EnumValue",t.LIST="ListValue",t.OBJECT="ObjectValue",t.OBJECT_FIELD="ObjectField",t.DIRECTIVE="Directive",t.NAMED_TYPE="NamedType",t.LIST_TYPE="ListType",t.NON_NULL_TYPE="NonNullType",t.SCHEMA_DEFINITION="SchemaDefinition",t.OPERATION_TYPE_DEFINITION="OperationTypeDefinition",t.SCALAR_TYPE_DEFINITION="ScalarTypeDefinition",t.OBJECT_TYPE_DEFINITION="ObjectTypeDefinition",t.FIELD_DEFINITION="FieldDefinition",t.INPUT_VALUE_DEFINITION="InputValueDefinition",t.INTERFACE_TYPE_DEFINITION="InterfaceTypeDefinition",t.UNION_TYPE_DEFINITION="UnionTypeDefinition",t.ENUM_TYPE_DEFINITION="EnumTypeDefinition",t.ENUM_VALUE_DEFINITION="EnumValueDefinition",t.INPUT_OBJECT_TYPE_DEFINITION="InputObjectTypeDefinition",t.TYPE_EXTENSION_DEFINITION="TypeExtensionDefinition",t.DIRECTIVE_DEFINITION="DirectiveDefinition"},function(e,t,n){"use strict";function r(e,t){var n=new s(E,0,0,0,0,null);return{source:e,options:t,lastToken:n,token:n,line:1,lineStart:0,advance:i}}function i(){var e=this.lastToken=this.token;if(e.kind!==k){do{e=e.next=u(this,e)}while(e.kind===M);this.token=e}return e}function o(e){var t=e.value;return t?e.kind+' "'+t+'"':e.kind}function s(e,t,n,r,i,o,s){this.kind=e,this.start=t,this.end=n,this.line=r,this.column=i,this.value=s,this.prev=o,this.next=null}function a(e){return isNaN(e)?k:e<127?JSON.stringify(String.fromCharCode(e)):'"\\u'+("00"+e.toString(16).toUpperCase()).slice(-4)+'"'}function u(e,t){var n=e.source,r=n.body,i=r.length,o=l(r,t.end,e),u=e.line,p=1+o-e.lineStart;if(o>=i)return new s(k,i,i,u,p,t);var v=U.call(r,o);if(v<32&&9!==v&&10!==v&&13!==v)throw(0,y.syntaxError)(n,o,"Cannot contain the invalid character "+a(v)+".");switch(v){case 33:return new s(b,o,o+1,u,p,t);case 35:return d(n,o,u,p,t);case 36:return new s(T,o,o+1,u,p,t);case 40:return new s(w,o,o+1,u,p,t);case 41:return new s(S,o,o+1,u,p,t);case 46:if(46===U.call(r,o+1)&&46===U.call(r,o+2))return new s(I,o,o+3,u,p,t);break;case 58:return new s(N,o,o+1,u,p,t);case 61:return new s(O,o,o+1,u,p,t);case 64:return new s(x,o,o+1,u,p,t);case 91:return new s(D,o,o+1,u,p,t);case 93:return new s(P,o,o+1,u,p,t);case 123:return new s(R,o,o+1,u,p,t);case 124:return new s(_,o,o+1,u,p,t);case 125:return new s(A,o,o+1,u,p,t);case 65:case 66:case 67:case 68:case 69:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 81:case 82:case 83:case 84:case 85:case 86:case 87:case 88:case 89:case 90:case 95:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:return g(n,o,u,p,t);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return f(n,o,v,u,p,t);case 34:return m(n,o,u,p,t)}throw(0,y.syntaxError)(n,o,c(v))}function c(e){return 39===e?"Unexpected single quote character ('), did you mean to use a double quote (\")?":"Cannot parse the unexpected character "+a(e)+"."}function l(e,t,n){for(var r=e.length,i=t;i<r;){var o=U.call(e,i);if(9===o||32===o||44===o||65279===o)++i;else if(10===o)++i,++n.line,n.lineStart=i;else{if(13!==o)break;10===U.call(e,i+1)?i+=2:++i,++n.line,n.lineStart=i}}return i}function d(e,t,n,r,i){var o=e.body,a=void 0,u=t;do{a=U.call(o,++u)}while(null!==a&&(a>31||9===a));return new s(M,t,u,n,r,i,F.call(o,t+1,u))}function f(e,t,n,r,i,o){var u=e.body,c=n,l=t,d=!1;if(45===c&&(c=U.call(u,++l)),48===c){if((c=U.call(u,++l))>=48&&c<=57)throw(0,y.syntaxError)(e,l,"Invalid number, unexpected digit after 0: "+a(c)+".")}else l=p(e,l,c),c=U.call(u,l);return 46===c&&(d=!0,c=U.call(u,++l),l=p(e,l,c),c=U.call(u,l)),69!==c&&101!==c||(d=!0,c=U.call(u,++l),43!==c&&45!==c||(c=U.call(u,++l)),l=p(e,l,c)),new s(d?j:q,t,l,r,i,o,F.call(u,t,l))}function p(e,t,n){var r=e.body,i=t,o=n;if(o>=48&&o<=57){do{o=U.call(r,++i)}while(o>=48&&o<=57);return i}throw(0,y.syntaxError)(e,i,"Invalid number, expected digit but got: "+a(o)+".")}function m(e,t,n,r,i){for(var o=e.body,u=t+1,c=u,l=0,d="";u<o.length&&null!==(l=U.call(o,u))&&10!==l&&13!==l&&34!==l;){if(l<32&&9!==l)throw(0,y.syntaxError)(e,u,"Invalid character within String: "+a(l)+".");if(++u,92===l){switch(d+=F.call(o,c,u-1),l=U.call(o,u)){case 34:d+='"';break;case 47:d+="/";break;case 92:d+="\\";break;case 98:d+="\b";break;case 102:d+="\f";break;case 110:d+="\n";break;case 114:d+="\r";break;case 116:d+="\t";break;case 117:var f=v(U.call(o,u+1),U.call(o,u+2),U.call(o,u+3),U.call(o,u+4));if(f<0)throw(0,y.syntaxError)(e,u,"Invalid character escape sequence: \\u"+o.slice(u+1,u+5)+".");d+=String.fromCharCode(f),u+=4;break;default:throw(0,y.syntaxError)(e,u,"Invalid character escape sequence: \\"+String.fromCharCode(l)+".")}++u,c=u}}if(34!==l)throw(0,y.syntaxError)(e,u,"Unterminated string.");return d+=F.call(o,c,u),new s(C,t,u+1,n,r,i,d)}function v(e,t,n,r){return h(e)<<12|h(t)<<8|h(n)<<4|h(r)}function h(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:-1}function g(e,t,n,r,i){for(var o=e.body,a=o.length,u=t+1,c=0;u!==a&&null!==(c=U.call(o,u))&&(95===c||c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122);)++u;return new s(L,t,u,n,r,i,F.call(o,t,u))}Object.defineProperty(t,"__esModule",{value:!0}),t.TokenKind=void 0,t.createLexer=r,t.getTokenDesc=o;var y=n(31),E="<SOF>",k="<EOF>",b="!",T="$",w="(",S=")",I="...",N=":",O="=",x="@",D="[",P="]",R="{",_="|",A="}",L="Name",q="Int",j="Float",C="String",M="Comment",U=(t.TokenKind={SOF:E,EOF:k,BANG:b,DOLLAR:T,PAREN_L:w,PAREN_R:S,SPREAD:I,COLON:N,EQUALS:O,AT:x,BRACKET_L:D,BRACKET_R:P,BRACE_L:R,PIPE:_,BRACE_R:A,NAME:L,INT:q,FLOAT:j,STRING:C,COMMENT:M},String.prototype.charCodeAt),F=String.prototype.slice;s.prototype.toJSON=s.prototype.inspect=function(){return{kind:this.kind,value:this.value,line:this.line,column:this.column}}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});t.Source=function e(t,n){r(this,e),this.body=t,this.name=n||"GraphQL request"}},function(e,t,n){"use strict";function r(e,t,n){var r=n||u,o=void 0,s=Array.isArray(e),l=[e],d=-1,f=[],p=void 0,m=[],v=[],h=e;do{d++;var g=d===l.length,y=void 0,E=void 0,k=g&&0!==f.length;if(g){if(y=0===v.length?void 0:m.pop(),E=p,p=v.pop(),k){if(s)E=E.slice();else{var b={};for(var T in E)E.hasOwnProperty(T)&&(b[T]=E[T]);E=b}for(var w=0,S=0;S<f.length;S++){var I=f[S][0],N=f[S][1];s&&(I-=w),s&&null===N?(E.splice(I,1),w++):E[I]=N}}d=o.index,l=o.keys,f=o.edits,s=o.inArray,o=o.prev}else{if(y=p?s?d:l[d]:void 0,null===(E=p?p[y]:h)||void 0===E)continue;p&&m.push(y)}var O=void 0;if(!Array.isArray(E)){if(!i(E))throw new Error("Invalid AST Node: "+JSON.stringify(E));var x=a(t,E.kind,g);if(x){if((O=x.call(t,E,y,p,m,v))===c)break;if(!1===O){if(!g){m.pop();continue}}else if(void 0!==O&&(f.push([y,O]),!g)){if(!i(O)){m.pop();continue}E=O}}}void 0===O&&k&&f.push([y,E]),g||(o={inArray:s,index:d,keys:l,edits:f,prev:o},s=Array.isArray(E),l=s?E:r[E.kind]||[],d=-1,f=[],p&&v.push(p),p=E)}while(void 0!==o);return 0!==f.length&&(h=f[f.length-1][1]),h}function i(e){return e&&"string"==typeof e.kind}function o(e){var t=new Array(e.length);return{enter:function(n){for(var r=0;r<e.length;r++)if(!t[r]){var i=a(e[r],n.kind,!1);if(i){var o=i.apply(e[r],arguments);if(!1===o)t[r]=n;else if(o===c)t[r]=c;else if(void 0!==o)return o}}},leave:function(n){for(var r=0;r<e.length;r++)if(t[r])t[r]===n&&(t[r]=null);else{var i=a(e[r],n.kind,!0);if(i){var o=i.apply(e[r],arguments);if(o===c)t[r]=c;else if(void 0!==o&&!1!==o)return o}}}}}function s(e,t){return{enter:function(n){e.enter(n);var r=a(t,n.kind,!1);if(r){var o=r.apply(t,arguments);return void 0!==o&&(e.leave(n),i(o)&&e.enter(o)),o}},leave:function(n){var r=a(t,n.kind,!0),i=void 0;return r&&(i=r.apply(t,arguments)),e.leave(n),i}}}function a(e,t,n){var r=e[t];if(r){if(!n&&"function"==typeof r)return r;var i=n?r.leave:r.enter;if("function"==typeof i)return i}else{var o=n?e.leave:e.enter;if(o){if("function"==typeof o)return o;var s=o[t];if("function"==typeof s)return s}}}Object.defineProperty(t,"__esModule",{value:!0}),t.visit=r,t.visitInParallel=o,t.visitWithTypeInfo=s,t.getVisitFn=a;var u=t.QueryDocumentKeys={Name:[],Document:["definitions"],OperationDefinition:["name","variableDefinitions","directives","selectionSet"],VariableDefinition:["variable","type","defaultValue"],Variable:["name"],SelectionSet:["selections"],Field:["alias","name","arguments","directives","selectionSet"],Argument:["name","value"],FragmentSpread:["name","directives"],InlineFragment:["typeCondition","directives","selectionSet"],FragmentDefinition:["name","typeCondition","directives","selectionSet"],IntValue:[],FloatValue:[],StringValue:[],BooleanValue:[],NullValue:[],EnumValue:[],ListValue:["values"],ObjectValue:["fields"],ObjectField:["name","value"],Directive:["name","arguments"],NamedType:["name"],ListType:["type"],NonNullType:["type"],SchemaDefinition:["directives","operationTypes"],OperationTypeDefinition:["type"],ScalarTypeDefinition:["name","directives"],ObjectTypeDefinition:["name","interfaces","directives","fields"],FieldDefinition:["name","arguments","type","directives"],InputValueDefinition:["name","type","defaultValue","directives"],InterfaceTypeDefinition:["name","directives","fields"],UnionTypeDefinition:["name","directives","types"],EnumTypeDefinition:["name","directives","values"],EnumValueDefinition:["name","directives"],InputObjectTypeDefinition:["name","directives","fields"],TypeExtensionDefinition:["definition"],DirectiveDefinition:["name","arguments","locations"]},c=t.BREAK={}},function(e,t){e.exports=require("async")},function(e,t){e.exports=require("connect-mongo")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("fakerator")},function(e,t){e.exports=require("graphql-server-express")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("mkdirp")},function(e,t){e.exports=require("nodemailer")},function(e,t){e.exports=require("nodemailer-html-to-text")},function(e,t){e.exports=require("nodemailer-mailgun-transport")},function(e,t){e.exports=require("nodemailer-sendgrid-transport")},function(e,t){e.exports=require("object-hash")},function(e,t,n){"use strict";function r(e){e.locals.app=f.app,e.use(function(e,t,n){return t.locals.url=e.protocol+"://"+e.headers.host+e.url,n()}),e.locals.year=v().format("YYYY"),e.locals.features=f.features}function i(e){if(e.use(S({filter:function(e,t){return/json|text|javascript|css/.test(t.getHeader("Content-Type"))},level:3,threshold:512})),e.set("port",f.port),e.use(E.urlencoded({extended:!0,limit:2*f.contentMaxLength})),e.use(b()),e.use(E.json()),e.use(I()),f.isProductionMode()&&(e.use(T({cache:{max:100}})),e.use(p.static(m.join(_,"public")))),e.use(g(m.join(_,"public","favicon.ico"))),e.use(k()),e.set("etag",!0),e.use(h()),f.isDevMode()){var t=n(134),r=new t.Stream;r.writable=!0,r.write=function(e){return d.debug(e)},e.use(y("dev",{stream:r}))}}function o(e){var t={fallbackLng:"en",whitelist:["en","hu"],ns:["app","frontend"],defaultNS:"frontend",load:"all",saveMissing:!0,saveMissingTo:"all",backend:{loadPath:m.join(_,"locales","{{lng}}","{{ns}}.json"),addPath:m.join(_,"locales","{{lng}}","{{ns}}.missing.json"),jsonIndent:4}};f.isTestMode()&&(t.whitelist=["en"]),D.use(R).use(P.LanguageDetector).init(t,function(t,n){e.t=n,t&&d.warn(t)}),D.on("failedLoading",function(e,t,n){console.log("failedLoading",e,t,n)}),e.use(P.handle(D)),e.get("/locales/resources.json",P.getResourcesHandler(D)),e.post("/locales/add/:lng/:ns",P.missingKeyHandler(D))}function s(e){e.set("views",m.join(_,"views")),e.set("view engine","pug"),f.isDevMode()?(e.set("showStackError",!0),e.set("view cache",!1),e.use(N.noCache()),e.locals.pretty=!0):(e.locals.cache="memory",e.set("view cache",!0))}function a(e,t){e.use(w({saveUninitialized:!0,resave:!1,secret:f.sessionSecret,store:new x({mongooseConnection:t.connection,collection:f.sessions.collection,autoReconnect:!0}),cookie:f.sessions.cookie,name:f.sessions.name}))}function u(e){e.use(N.xssFilter()),e.use(N.noSniff()),e.use(N.frameguard()),e.use(N.ieNoOpen()),e.use(O()),e.use(N.hidePoweredBy())}function c(e){n(68)(e),f.isTestMode()}function l(e){if(!f.isProductionMode()){var t=n(25),r=n(54),i=t(r),o=n(137);e.use(o(i,{noInfo:!0,publicPath:r.output.publicPath,headers:{"Access-Control-Allow-Origin":"*"},stats:{colors:!0}}));var s=n(138);e.use(s(i,{log:d.info}))}}var d=n(1),f=n(0),p=(n(17),n(18)),m=(n(42),n(6)),v=n(16),h=n(108),g=n(132),y=n(122),E=n(102),k=n(38),b=n(110),T=(n(106),n(123)),w=n(39),S=n(105),I=n(121),N=n(114),O=n(115),x=(n(11),n(37)(w)),D=n(116),P=n(117),R=n(118),_=m.normalize(m.join(f.rootPath,"server"));e.exports=function(e){var t=p();r(t),i(t),s(t),u(t),o(t),a(t,e),c(t),l(t),n(7).loadServices(t,e);var d=n(13).init(t,e);return d._app=t,n(86)(t,e),d}},function(e,t,n){"use strict";var r=n(1),i=n(0),o=n(10),s=n(43);o.existsSync(i.dataFolder)||s.sync(i.dataFolder),i.isProductionMode()||(r.info("Loaded configuration:"),r.info(i),r.info())},function(e,t,n){"use strict";var r=(n(0),n(1)),i=n(8),o=n(16),s=n(11),a=n(26),u=function(){if(0===s.connection.readyState)return process.exit(0);s.connection.close(function(){return a.stop(function(){return r.info(),r.info(i.bold("---------------------[ Server stopped at %s Uptime: %s ]---------------------------"),o().format("YYYY-MM-DD HH:mm:ss.SSS"),o.duration(1e3*process.uptime()).humanize()),process.exit(0)})})};process.on("SIGINT",u).on("SIGTERM",u)},function(e,t,n){"use strict";var r=n(124),i=n(104),o=n(131),s=n(1);e.exports=function(){var e=i.Gauge,t=r.totalmem(),n=r.freemem(),a=t-n,u=o(n);s.info("CPU:\t\tArch: "+r.arch()+", Cores: "+r.cpus().length),s.info("Memory:\t\t"+e(a,t,20,.8*t,u+" free")),s.info("OS:\t\t"+r.platform()+" ("+r.type()+")")}},function(e,t,n){"use strict";(function(t){var r=n(6);n(25);e.exports={devtool:"#inline-source-map",entry:{app:["./client/app/main.js"],vendor:["es6-promise","lodash","moment","apollo-client","graphql-tag","i18next"],frontend:["./client/frontend/main.js"]},output:{path:r.resolve(t,"..","server","public","app"),publicPath:"/app/",filename:"[name].js",chunkFilename:"[chunkhash].js"},module:{noParse:/es6-promise\.js$/,rules:[{test:/\.css$/,loaders:["style-loader","css-loader"]},{test:/\.js$/,loader:"babel-loader",exclude:[/node_modules/,/vendor/]},{test:/\.gif$/,loader:"url-loader",options:{name:"images/[name]-[hash:6].[ext]",limit:1e4}},{test:/\.png$/,loader:"url-loader",options:{name:"images/[name]-[hash:6].[ext]",limit:1e4}},{test:/\.jpg$/,loader:"file-loader",options:{name:"images/[name]-[hash:6].[ext]"}},{test:/\.(woff2?|svg)$/,loader:"url-loader",options:{limit:1e4,prefix:"font/"}},{test:/\.(ttf|eot)$/,loader:"file-loader",options:{prefix:"font/"}}]},resolve:{extensions:[".js",".json"],mainFiles:["index"],alias:{images:r.resolve(t,"..","client","images")}},performance:{hints:!1},plugins:[]}}).call(t,"build")},function(e,t,n){"use strict";var r=(n(6),n(25)),i=n(139),o=n(53);o.entry.app.unshift("webpack-hot-middleware/client"),o.entry.frontend.unshift("webpack-hot-middleware/client"),e.exports=i(o,{devtool:"#inline-source-map",module:{rules:[{test:/\.scss$/,loaders:["style-loader","css-loader","postcss-loader","sass-loader"]}]},performance:{hints:!1},plugins:[new r.HotModuleReplacementPlugin,new r.NoErrorsPlugin]})},function(e,t,n){"use strict";var r=n(1),i=(n(0),n(2)),o=(n(14),n(40)()),s=n(3),a=n(27),u=n(28);e.exports=function(){var e=a.find({}).exec().then(function(e){0===e.length&&(r.warn("Load default Devices to DB..."),i.times(36,function(){return new a({address:o.internet.ip(),type:o.random.arrayElement(["rasperry","odroid","nanopi","pc"]),name:o.populate("#{names.firstName}'s device"),description:o.lorem.sentence(),status:o.random.boolean("80")?1:0,lastCommunication:Date.now()}).save().then(function(){r.info("Default devices created!")})}))}),t=u.find({}).exec(function(e,t){0===t.length&&(r.warn("Load default Posts to DB..."),s.find({}).lean().select("_id").exec(function(e,t){t&&t.length>0&&i.times(60,function(){var e=o.entity.post(o.random.number(2,1));return new u({title:e.title,content:e.content,author:o.random.arrayElement(t)._id}).save().then(function(){r.info("Default posts created!")})})}))});return Promise.all([e,t])}},function(e,t,n){"use strict";e.exports={counter:0}},function(e,t,n){"use strict";var r=n(1),i=(n(0),n(4)),o=n(56);e.exports={settings:{name:"counter",version:1,namespace:"counter",rest:!0,ws:!0,permission:i.PERM_LOGGEDIN},actions:{find:{cache:!0,handler:function(e){return Promise.resolve(o.counter)}},create:function(e){if(e.params.value)return this.changeCounter(e,parseInt(e.params.value));throw new Error("Missing value from request!")},reset:{permission:i.PERM_ADMIN,handler:function(e){return this.changeCounter(e,0)}},increment:function(e){return this.changeCounter(e,o.counter+1)},decrement:function(e){return this.changeCounter(e,o.counter-1)}},methods:{changeCounter:function(e,t){return o.counter=t,r.info(e.user.username+" changed the counter to ",o.counter),this.notifyModelChanges(e,"changed",o.counter),Promise.resolve(o.counter)}},init:function(e){},socket:{afterConnection:function(e,t){e.emit("/counter/changed",o.counter)}},graphql:{query:"\n\t\t\tcounter: Int\n\t\t",types:"",mutation:"\n\t\t\tcounterCreate(value: Int!): Int\n\t\t\tcounterReset: Int\n\t\t\tcounterIncrement: Int\n\t\t\tcounterDecrement: Int\n\t\t",resolvers:{Query:{counter:"find"},Mutation:{counterCreate:"create",counterReset:"reset",counterIncrement:"increment",counterDecrement:"decrement"}}}}},function(e,t,n){"use strict";var r=(n(1),n(0),n(4)),i=(n(2),n(27));e.exports={settings:{name:"devices",version:1,namespace:"devices",rest:!0,ws:!0,graphql:!0,permission:r.PERM_LOGGEDIN,role:"user",collection:i,modelPropFilter:"code type address name description status lastCommunication createdAt updatedAt"},actions:{find:{cache:!0,handler:function(e){var t=this,n={},r=i.find(n);return e.queryPageSort(r).exec().then(function(e){return t.toJSON(e)})}},get:{cache:!0,handler:function(e){return e.assertModelIsExist(e.t("app:DeviceNotFound")),Promise.resolve(e.model)}},create:function(e){var t=this;return this.validateParams(e,!0),new i({address:e.params.address,type:e.params.type,name:e.params.name,description:e.params.description,status:e.params.status}).save().then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)}).then(function(n){return t.notifyModelChanges(e,"created",n),n})},update:function(e){var t=this;return e.assertModelIsExist(e.t("app:DeviceNotFound")),this.validateParams(e),this.collection.findById(e.modelID).exec().then(function(t){return null!=e.params.address&&(t.address=e.params.address),null!=e.params.type&&(t.type=e.params.type),null!=e.params.name&&(t.name=e.params.name),null!=e.params.description&&(t.description=e.params.description),null!=e.params.status&&(t.status=e.params.status),t.save()}).then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)}).then(function(n){return t.notifyModelChanges(e,"updated",n),n})},remove:function(e){var t=this;return e.assertModelIsExist(e.t("app:DeviceNotFound")),i.remove({_id:e.modelID}).then(function(){return e.model}).then(function(n){return t.notifyModelChanges(e,"removed",n),n})}},methods:{validateParams:function(e,t){if((t||e.hasParam("name"))&&e.validateParam("name").trim().notEmpty(e.t("app:DeviceNameCannotBeBlank")).end(),(t||e.hasParam("status"))&&e.validateParam("status").isNumber(),e.validateParam("description").trim().end(),e.validateParam("address").trim().end(),e.validateParam("type").trim().end(),e.hasValidationErrors())throw e.errorBadRequest(r.ERR_VALIDATION_ERROR,e.validationErrors)}},init:function(e){},socket:{afterConnection:function(e,t){}},graphql:{query:"\n\t\t\tdevices(limit: Int, offset: Int, sort: String): [Device]\n\t\t\tdevice(code: String): Device\n\t\t",types:"\n\t\t\ttype Device {\n\t\t\t\tcode: String!\n\t\t\t\taddress: String\n\t\t\t\ttype: String\n\t\t\t\tname: String\n\t\t\t\tdescription: String\n\t\t\t\tstatus: Int\n\t\t\t\tlastCommunication: Timestamp\n\t\t\t}\n\t\t",mutation:"\n\t\t\tdeviceCreate(name: String!, address: String, type: String, description: String, status: Int): Device\n\t\t\tdeviceUpdate(code: String!, name: String, address: String, type: String, description: String, status: Int): Device\n\t\t\tdeviceRemove(code: String!): Device\n\t\t",resolvers:{Query:{devices:"find",device:"get"},Mutation:{deviceCreate:"create",deviceUpdate:"update",deviceRemove:"remove"}}}}},function(e,t,n){"use strict";e.exports=n(3)},function(e,t,n){"use strict";var r=(n(1),n(0),n(13),n(4)),i=(n(2),n(59));e.exports={settings:{name:"persons",version:1,namespace:"persons",rest:!0,ws:!0,graphql:!0,permission:r.PERM_LOGGEDIN,role:"user",collection:i,modelPropFilter:"code username fullName avatar lastLogin roles"},actions:{get:{cache:!0,handler:function(e){return e.assertModelIsExist(e.t("app:UserNotFound")),Promise.resolve(e.model)}}},methods:{},graphql:{query:"\n\t\t\t# users(limit: Int, offset: Int, sort: String): [Person]\n\t\t\tperson(code: String): Person\n\t\t",types:"\n\t\t\ttype Person {\n\t\t\t\tcode: String!\n\t\t\t\tfullName: String\n\t\t\t\tusername: String\n\t\t\t\troles: [String]\n\t\t\t\tavatar: String\n\t\t\t\tlastLogin: Timestamp\n\n\t\t\t\tposts(limit: Int, offset: Int, sort: String): [Post]\n\t\t\t}\n\t\t",mutation:"\n\t\t",resolvers:{Query:{person:"get"},Person:{posts:function(e,t,n){var r=n.ctx,i=r.services("posts");if(i)return i.actions.find(r.copy(Object.assign(t,{author:e.code})))}}}}}},function(e,t,n){"use strict";var r=(n(1),n(0),n(4)),i=(n(2),n(28));e.exports={settings:{name:"posts",version:1,namespace:"posts",rest:!0,ws:!0,graphql:!0,permission:r.PERM_LOGGEDIN,role:"user",collection:i,modelPropFilter:"code title content author votes voters views createdAt editedAt",modelPopulates:{author:"persons",voters:"persons"}},actions:{find:{cache:!0,handler:function(e){var t=this,n={};"my"==e.params.filter?n.author=e.user.id:null!=e.params.author&&(n.author=this.personService.decodeID(e.params.author));var r=i.find(n);return e.queryPageSort(r).exec().then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)})}},get:{cache:!0,permission:r.PERM_PUBLIC,handler:function(e){var t=this;return e.assertModelIsExist(e.t("app:PostNotFound")),i.findByIdAndUpdate(e.modelID,{$inc:{views:1}}).exec().then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)})}},create:{handler:function(e){var t=this;return this.validateParams(e,!0),new i({title:e.params.title,content:e.params.content,author:e.user.id}).save().then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)}).then(function(n){return t.notifyModelChanges(e,"created",n),n})}},update:{permission:r.PERM_OWNER,handler:function(e){var t=this;return e.assertModelIsExist(e.t("app:PostNotFound")),this.validateParams(e),this.collection.findById(e.modelID).exec().then(function(t){return null!=e.params.title&&(t.title=e.params.title),null!=e.params.content&&(t.content=e.params.content),t.editedAt=Date.now(),t.save()}).then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)}).then(function(n){return t.notifyModelChanges(e,"updated",n),n})}},remove:{permission:r.PERM_OWNER,handler:function(e){var t=this;return e.assertModelIsExist(e.t("app:PostNotFound")),i.remove({_id:e.modelID}).then(function(){return e.model}).then(function(n){return t.notifyModelChanges(e,"removed",n),n})}},vote:function(e){var t=this;return e.assertModelIsExist(e.t("app:PostNotFound")),this.collection.findById(e.modelID).exec().then(function(t){if(-1!==t.voters.indexOf(e.user.id))throw e.errorBadRequest(r.ERR_ALREADY_VOTED,e.t("app:YouHaveAlreadyVotedThisPost"));return t}).then(function(t){return i.findByIdAndUpdate(t.id,{$addToSet:{voters:e.user.id},$inc:{votes:1}},{new:!0})}).then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)}).then(function(n){return t.notifyModelChanges(e,"voted",n),n})},unvote:function(e){var t=this;return e.assertModelIsExist(e.t("app:PostNotFound")),this.collection.findById(e.modelID).exec().then(function(t){if(-1==t.voters.indexOf(e.user.id))throw e.errorBadRequest(r.ERR_NOT_VOTED_YET,e.t("app:YouHaveNotVotedThisPostYet"));return t}).then(function(t){return i.findByIdAndUpdate(t.id,{$pull:{voters:e.user.id},$inc:{votes:-1}},{new:!0})}).then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)}).then(function(n){return t.notifyModelChanges(e,"unvoted",n),n})}},methods:{validateParams:function(e,t){if((t||e.hasParam("title"))&&e.validateParam("title").trim().notEmpty(e.t("app:PostTitleCannotBeEmpty")).end(),(t||e.hasParam("content"))&&e.validateParam("content").trim().notEmpty(e.t("app:PostContentCannotBeEmpty")).end(),e.hasValidationErrors())throw e.errorBadRequest(r.ERR_VALIDATION_ERROR,e.validationErrors)}},ownerChecker:function(e){return new Promise(function(t,n){e.assertModelIsExist(e.t("app:PostNotFound")),e.model.author.code==e.user.code||e.isAdmin()?t():n()})},init:function(e){this.personService=e.services("persons"),r.append(["ALREADY_VOTED","NOT_VOTED_YET"],"ERR")},socket:{afterConnection:function(e,t){}},graphql:{query:"\n\t\t\tposts(limit: Int, offset: Int, sort: String): [Post]\n\t\t\tpost(code: String): Post\n\t\t",types:"\n\t\t\ttype Post {\n\t\t\t\tcode: String!\n\t\t\t\ttitle: String\n\t\t\t\tcontent: String\n\t\t\t\tauthor: Person!\n\t\t\t\tviews: Int\n\t\t\t\tvotes: Int,\n\t\t\t\tvoters(limit: Int, offset: Int, sort: String): [Person]\n\t\t\t\tcreatedAt: Timestamp\n\t\t\t\tcreatedAt: Timestamp\n\t\t\t}\n\t\t",mutation:"\n\t\t\tpostCreate(title: String!, content: String!): Post\n\t\t\tpostUpdate(code: String!, title: String, content: String): Post\n\t\t\tpostRemove(code: String!): Post\n\n\t\t\tpostVote(code: String!): Post\n\t\t\tpostUnvote(code: String!): Post\n\t\t",resolvers:{Query:{posts:"find",post:"get"},Mutation:{postCreate:"create",postUpdate:"update",postRemove:"remove",postVote:"vote",postUnvote:"unvote"}}}}},function(e,t,n){"use strict";e.exports=n(3)},function(e,t,n){"use strict";var r=(n(1),n(0),n(4)),i=(n(2),n(62));e.exports={settings:{name:"profile",version:1,namespace:"profile",rest:!0,ws:!0,graphql:!0,permission:r.PERM_LOGGEDIN,role:"user",collection:i,modelPropFilter:"code username fullName email avatar passwordLess provider profile socialLinks roles apiKey lastLogin locale status createdAt updatedAt"},actions:{get:{cache:!1,handler:function(e){var t=this;return i.findById(i.schema.methods.decodeID(e.user.code)).exec().then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)})}}},methods:{},graphql:{query:"\n\t\t\tprofile: Profile\n\t\t",types:"\n\t\t\ttype Profile {\n\t\t\t\tcode: String!\n\t\t\t\tfullName: String\n\t\t\t\temail: String\n\t\t\t\tusername: String\n\t\t\t\tpasswordLess: Boolean\n\t\t\t\tprovider: String\n\t\t\t\tprofile: SocialProfile\n\t\t\t\tsocialLinks: SocialLinks\n\t\t\t\troles: [String]\n\t\t\t\tverified: Boolean\n\t\t\t\tapiKey: String\n\t\t\t\tlocale: String\n\t\t\t\tavatar: String\n\t\t\t\tcreatedAt: Timestamp\n\t\t\t\tupdatedAt: Timestamp\n\t\t\t\tlastLogin: Timestamp\n\t\t\t\tstatus: Boolean\n\t\t\t}\n\n\t\t\ttype SocialProfile {\n\t\t\t\tname: String\n\t\t\t\tgender: String\n\t\t\t\tpicture: String\n\t\t\t\tlocation: String\n\t\t\t}\n\n\t\t\ttype SocialLinks {\n\t\t\t\tfacebook: String\n\t\t\t\ttwitter: String\n\t\t\t\tgoogle: String\n\t\t\t\tgithub: String\n\t\t\t}\n\t\t",mutation:"\n\t\t",resolvers:{Query:{profile:"get"}}}}},function(e,t,n){"use strict";var r=(n(1),n(0),n(4)),i=n(2),o=n(13),s=void 0;e.exports={settings:{name:"session",version:1,namespace:"session",rest:!0,ws:!0,graphql:!0,permission:r.PERM_LOGGEDIN,role:"user"},actions:{me:function(e){return Promise.resolve(e.user).then(function(e){return s.toJSON(e)})},onlineUsers:function(e){return Promise.resolve().then(function(){return s.toJSON(i.map(o.userSockets,function(e){return e.request.user}))})}},init:function(e){s=this.services("persons")},graphql:{query:"\n\t\t\tme: Person\n\t\t\tonlineUsers: [Person]\n\t\t",mutation:"\n\t\t",resolvers:{Query:{me:"me",onlineUsers:"onlineUsers"}}}}},function(e,t,n){"use strict";var r=n(6),i=n(23);e.exports={app:{title:i.title,version:i.version,description:i.description,keywords:i.keywords.join(","),url:"http://localhost:"+(process.env.PORT||3e3)+"/",contactEmail:"hello@vem-app.com"},ip:process.env.NODE_IP||"0.0.0.0",port:process.env.PORT||3e3,rootPath:global.rootPath,dataFolder:r.join(global.rootPath,"data"),uploadLimit:2097152,sessions:{cookie:{maxAge:6048e5,httpOnly:!0,secure:!1},name:"sessionId",collection:"sessions"},test:!1,db:{uri:process.env.MONGO_URI||"mongodb://localhost/"+i.config.dbName+"-dev",options:{user:"",pass:"",server:{socketOptions:{keepAlive:1}}}},redis:{enabled:!1,uri:process.env.REDIS_URI||"redis://localhost:6379",options:null},cacheTimeout:300,mailer:{enabled:!1,from:"noreply@vem-app.com"},features:{disableSignUp:!1,verificationRequired:!0},authKeys:{google:{clientID:null,clientSecret:null},facebook:{clientID:null,clientSecret:null},github:{clientID:null,clientSecret:null},twitter:{clientID:null,clientSecret:null}},logging:{console:{level:"debug"},file:{enabled:!1,path:r.join(global.rootPath,"logs"),level:"info",json:!1,exceptionFile:!0},graylog:{enabled:!1},papertrail:{enabled:!1,host:null,port:null,level:"debug",program:"vem"},logentries:{enabled:!1,token:null},loggly:{enabled:!1,token:null,subdomain:null},logsene:{enabled:!1,token:null},logzio:{enabled:!1,token:null}},agendaTimer:"one minute"}},function(e,t,n){"use strict";var r=n(23);e.exports={app:{},db:{uri:process.env.MONGO_URI||"mongodb://localhost/"+r.config.dbName,options:{user:process.env.MONGO_USERNAME||"",pass:process.env.MONGO_PASSWORD||""}}}},function(e,t,n){"use strict";var r=n(23);e.exports={app:{title:r.name+" [Test mode]"},hashSecret:"71IIYMzMb0egTaCvvdijhUajAOjsrurzyRX5ziskMk4",sessionSecret:"MB9x-hOkx-UdcCbOprxggu-Wv1PetuoqzBny1h8DULA",mailer:{from:"noreply@vem-app.com",transport:"smtp",smtp:{host:"mailtrap.io",port:2525,auth:{user:"367335eaa82697636",pass:"e5a76af9b056d0"}}},test:!0,db:{uri:"mongodb://localhost/"+r.config.dbName+"-test",options:{user:"",pass:""}}}},function(e,t,n){"use strict";var r=n(1),i=(n(0),n(5)),o=n(6),s=n(8),a=n(3);e.exports=function(e){e.use(i.initialize()),e.use(i.session()),i.serializeUser(function(e,t){return t(null,e.id)}),i.deserializeUser(function(e,t){a.findOne({_id:e},"-password",function(e,n){return e?t(e):1!==n.status?t(null,!1):t(null,n)})}),r.info(""),r.info(s.bold("Search passport strategies..."));!function(e){e.keys().map(function(t){r.info("  Loading passport strategy file "+o.basename(t)+"...");var n=e(t);return n(),n})}(n(97))}},function(e,t,n){"use strict";var r=n(5),i=n(129).Strategy,o=n(3);e.exports=function(){r.use(new i({passReqToCallback:!0},function(e,t,n){return o.findOne({apiKey:t},function(t,r){return t?n(t):r?r.verified?1!==r.status?n(null,!1,{message:e.t("UserDisabledOrDeleted")}):n(null,r):n(null,!1,{message:e.t("PleaseActivateAccount")}):n(null,!1,{message:e.t("UnknowAPIKey")})})}))}},function(e,t,n){"use strict";var r=(n(1),n(0)),i=n(9),o=n(5),s=n(125).Strategy;n(3);e.exports=function(){r.authKeys.facebook.clientID&&r.authKeys.facebook.clientSecret&&o.use("facebook",new s({clientID:r.authKeys.facebook.clientID,clientSecret:r.authKeys.facebook.clientSecret,callbackURL:"/auth/facebook/callback",profileFields:["name","email","link","locale","timezone"],passReqToCallback:!0},function(e,t,n,r,o){i.linkToSocialAccount({req:e,accessToken:t,refreshToken:n,profile:r,done:o,provider:"facebook",email:r._json.email,userData:{name:r.name.givenName+" "+r.name.familyName,gender:r._json.gender,picture:"https://graph.facebook.com/"+r.id+"/picture?type=large",location:r._json.location?r._json.location.name:null}})}))}},function(e,t,n){"use strict";var r=n(1),i=n(0),o=n(9),s=n(5),a=n(126).Strategy;n(3);e.exports=function(){i.authKeys.github.clientID&&i.authKeys.github.clientSecret&&s.use("github",new a({clientID:i.authKeys.github.clientID,clientSecret:i.authKeys.github.clientSecret,callbackURL:"/auth/github/callback",scope:["user:email"],passReqToCallback:!0},function(e,t,n,i,s){r.info("Received profile: ",i);var a=void 0;i.emails&&i.emails.length>0&&((a=i.emails.find(function(e){return e.primary}))||(a=i.emails[0])),o.linkToSocialAccount({req:e,accessToken:t,refreshToken:n,profile:i,done:s,provider:"github",username:i.username,email:a?a.value:null,userData:{name:i.displayName,gender:null,picture:i._json.avatar_url,location:i._json.location}})}))}},function(e,t,n){"use strict";var r=(n(1),n(0)),i=n(9),o=n(5),s=n(127).OAuth2Strategy;n(3);e.exports=function(){r.authKeys.google.clientID&&r.authKeys.google.clientSecret&&o.use("google",new s({clientID:r.authKeys.google.clientID,clientSecret:r.authKeys.google.clientSecret,callbackURL:"/auth/google/callback",passReqToCallback:!0},function(e,t,n,r,o){i.linkToSocialAccount({req:e,accessToken:t,refreshToken:n,profile:r,done:o,provider:"google",email:r.emails[0].value,userData:{name:r.displayName,gender:r.gender,picture:r.photos&&r.photos.length>0?r.photos[0].value.replace("sz=50","sz=200"):null,location:null}})}))}},function(e,t,n){"use strict";var r=n(5),i=n(128).Strategy,o=n(3);e.exports=function(){r.use(new i({usernameField:"username",passwordField:"password",passReqToCallback:!0},function(e,t,n,r){return o.findOne({$or:[{username:t},{email:t}]},function(t,i){return t?r(t):i?i.verified?1!==i.status?r(null,!1,{message:e.t("UserDisabledOrDeleted")}):i.passwordLess?r(null,!1,{message:e.t("PasswordlessAccountLeaveEmpty")}):void i.comparePassword(n,function(t,n){return t?r(t):!0!==n?r(null,!1,{message:e.t("InvalidPassword")}):r(null,i)}):r(null,!1,{message:e.t("PleaseActivateAccount")}):r(null,!1,{message:e.t("UnknowUsernameOrEmail")})})}))}},function(e,t,n){"use strict";var r=(n(1),n(0)),i=n(9),o=n(5),s=n(130).Strategy;n(3);e.exports=function(){r.authKeys.twitter.clientID&&r.authKeys.twitter.clientSecret&&o.use("twitter",new s({consumerKey:r.authKeys.twitter.clientID,consumerSecret:r.authKeys.twitter.clientSecret,callbackURL:"/auth/twitter/callback",passReqToCallback:!0},function(e,t,n,r,o){i.linkToSocialAccount({req:e,accessToken:t,refreshToken:n,profile:r,done:o,provider:"twitter",email:r.username+"@twitter.com",username:r.username,userData:{name:r.displayName,gender:null,picture:r._json.profile_image_url_https,location:r._json.location}})}))}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=(n(0),n(1)),s=(n(17),n(2),function(){function e(t,n){var i=this;r(this,e),this.cache={},this.prefix=t?t+":":"",this.ttl=n,n&&(this.timer=setInterval(function(){i.checkTTL()},3e4))}return i(e,[{key:"get",value:function(e){var t=this;return new Promise(function(n,r){var i=t.cache[t.prefix+e];i?(o.debug("[Cacher] GET "+t.prefix+e),n(i.data),i.expire=Date.now()+1e3*t.ttl):n(null)})}},{key:"set",value:function(e,t){return this.cache[this.prefix+e]={data:t,expire:Date.now()+1e3*this.ttl},o.debug("[Cacher] SET "+this.prefix+e),Promise.resolve(t)}},{key:"del",value:function(e){return delete this.cache[this.prefix+e],o.debug("[Cacher] DEL "+this.prefix+e),Promise.resolve()}},{key:"clean",value:function(e){return o.debug("[Cacher] CLEAR "+this.prefix+"*"),this.cache={},Promise.resolve()}},{key:"checkTTL",value:function(){var e=this,t=this,n=Date.now();Object.keys(this.cache).forEach(function(r){var i=e.cache[r];i.expire&&i.expire<n&&(o.debug("[Cacher] EXPIRED "+r),delete t.cache[r])})}}]),e}());e.exports=s},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=(n(0),n(1)),s=n(17),a=n(2),u=function(){function e(t,n){r(this,e),o.debug("Redis Cacher created. Prefix: "+t),this.prefix=t?t+":":"",this.ttl=n}return i(e,[{key:"get",value:function(e){return s.get(this.prefix+e).then(function(e){if(e)try{return JSON.parse(e)}catch(e){o.error("Redis result parse error!",e)}return e})}},{key:"set",value:function(e,t){return a.isObject(t)&&(t=JSON.stringify(t)),this.ttl?s.setex(this.prefix+e,this.ttl,t):s.set(this.prefix+e,t)}},{key:"del",value:function(e){return s.del(this.prefix+e,function(e){e&&o.error("Redis `del` error!",e)}),Promise.resolve()}},{key:"clean",value:function(e){var t=this;return function n(r,i){s.scan(r,"MATCH",t.prefix+(e||"*"),"COUNT",100,function(e,t){if(e)return i(e);var r=parseInt(t[0]),o=t[1];if(!r&&!o.length)return i(null);s.del(o,function(e){return e?i(e):r?void n(r,i):i(null)})})}(0,function(e){e&&o.error("Redis `scanDel` error!",e)}),Promise.resolve()}}]),e}();e.exports=u},function(e,t,n){"use strict";var r=(n(0),n(1),n(17),n(2),n(75)),i=n(76);e.exports=function(e,t,n){switch(e){case"redis":return new i(t,n);default:return new r(t,n)}}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(1),s=(n(0),n(12)),a=n(14),u=n(4),c=n(13),l=n(2),d=(n(48),void 0),f=function(){function e(t){r(this,e),this.id=a(),this.createdAt=Date.now(),this.service=t,this.io=t.io,this.app=null,this.req=null,this.res=null,this.action=null,this.t=null,this.user=null,this.socket=null,this.params=[],this.model=null,this.modelID=null,this.provider="internal",this.validationErrors=[],d||(d=n(7))}return i(e,[{key:"services",value:function(e){return d.get(e)}},{key:"copy",value:function(t,n){var r=l.defaults(new e(this.service),this);return r.provider="internal",r.params=!0===n?l.defaults(this.params,t):t,r}},{key:"responseTime",value:function(){return Date.now()-this.createdAt}},{key:"resolveModel",value:function(){var e=this;if(l.isFunction(this.service.modelResolver)){var t=this.service.$settings.idParamName||"id",n=this.params[t];if(null!=n)return this.service.modelResolver.call(this.service,this,n).then(function(t){return e.model=t,t})}return Promise.resolve(null)}},{key:"assertModelIsExist",value:function(e){if(!this.model)throw this.errorBadRequest(u.ERR_MODEL_NOT_FOUND,e);return!0}},{key:"checkPermission",value:function(){var e=this,t=this.action.permission||this.service.$settings.permission||u.PERM_LOGGEDIN;return t==u.PERM_PUBLIC?Promise.resolve():Promise.resolve().then(function(){e.user||e.errorUnauthorized()}).then(function(){t!=u.PERM_ADMIN||e.isAdmin()?t==u.PERM_USER&&-1==e.user.roles.indexOf(u.ROLE_USER)&&e.errorForbidden():e.errorForbidden()}).then(function(){if(t==u.PERM_OWNER&&l.isFunction(e.service.$schema.ownerChecker))return e.service.$schema.ownerChecker(e).catch(function(t){if(l.isObject(t))throw t;e.errorForbidden(u.ERR_ONLY_OWNER_CAN_EDIT_AND_DELETE,e.t("app:YouAreNotTheOwner"))})})}},{key:"broadcast",value:function(e,t){if(this.io){var n="/"+this.service.namespace+"/"+e;o.debug("Send WS broadcast message to '"+n+"':",t),this.io.emit(n,t)}}},{key:"emitUser",value:function(e,t){var n=this;if(!this.socket&&this.user&&(this.socket=l.find(c.userSockets,function(e){return e.request.user._id==n.user._id})),this.socket){var r="/"+this.service.namespace+"/"+e;o.debug("Send WS message to "+this.socket.request.user.username+" '"+r+"':",t),this.socket.emit(r,t)}}},{key:"emit",value:function(e,t,n){var r=this;if(n||(n=this.service.$settings.role),!n){var i="/"+this.service.namespace+"/"+e;return o.debug("Send WS broadcast message to '"+i+"':",t),void(this.socket?this.socket.broadcast.emit(i,t):this.io.emit(i,t))}if(this.io){var s="/"+this.service.namespace+"/"+e;o.debug("Send WS message to '"+n+"' role '"+s),l.each(c.userSockets,function(e){var i=e.request.user;if(i&&i.roles&&-1!==i.roles.indexOf(n)){if("socket"==r.provider&&i==r.user)return;o.debug("Send WS message to "+i.username+" '"+s+"':",t),e.emit(s,t)}})}}},{key:"hasParam",value:function(e,t){return null!=this.params[e]}},{key:"validateParam",value:function(e,t){var n=this,r={name:e,value:null,errors:[]};r.noError=function(){return 0==r.errors.length},r.addError=function(e){r.errors.push(e),n.validationErrors.push(e)},r.end=function(){return r.noError()&&(n.params[r.name]=r.value),r.value},r.throw=function(){if(!r.noError())throw new Error(r.errors.join(" "));return r.value},r.notEmpty=function(t){return null!=r.value&&""!==r.value||r.addError(t||"Parameter '"+e+"' is empty!"),l.isArray(r.value)&&0==r.value.length&&r.addError(t||"Parameter '"+e+"' is empty!"),r},r.isNumber=function(e){return null==r.value||l.isNumber(r.value)},r.trim=function(){return r.noError()&&null!=r.value&&(r.value=r.value.trim()),r};var i=this.params[e];return null!=i&&(r.value=i),r}},{key:"hasValidationErrors",value:function(){return this.validationErrors.length>0}},{key:"errorBadRequest",value:function(e,t){var n=new Error(t);throw n=l.defaults(s.BAD_REQUEST),e&&(n.type=e),t&&(n.message=t),n}},{key:"errorForbidden",value:function(e,t){var n=new Error(t);throw n=l.defaults(s.FORBIDDEN),e&&(n.type=e),t&&(n.message=t),n}},{key:"errorUnauthorized",value:function(e,t){var n=new Error(t);throw n=l.defaults(s.UNAUTHORIZED),e&&(n.type=e),t&&(n.message=t),n}},{key:"notifyChanges",value:function(e,t,n){var r={status:200,event:e,data:t};if(this.user){var i=this.services("persons");r.user=i.toJSON(this.user)}this.emit(e,r,n)}},{key:"queryPageSort",value:function(e){return this.params&&(this.params.limit&&e.limit(this.params.limit),this.params.offset&&e.skip(this.params.offset),this.params.sort&&e.sort(this.params.sort.replace(/,/," "))),e}},{key:"isAuthenticated",value:function(e){return null!=this.user}},{key:"hasRole",value:function(e){return this.user&&-1!=this.user.roles.indexOf(e)}},{key:"isAdmin",value:function(){return this.user&&this.hasRole(u.ROLE_ADMIN)}}],[{key:"CreateFromREST",value:function(t,n,r,i,o){var s=new e(t);return s.provider="rest",s.app=r,s.req=i,s.res=o,s.t=i.t,s.user=i.user,s.params=l.defaults({},i.query,i.params,i.body),s.action=n,s}},{key:"CreateFromSocket",value:function(t,n,r,i,o){var s=new e(t);return s.provider="socket",s.app=r,s.socket=i,s.t=r.t,s.user=i.request.user,s.params=o||{},s.action=n,s}},{key:"CreateFromGraphQL",value:function(t,n,r,i,o){var s=new e(t);return s.provider="graphql",s.t=o.t,s.params=i,s.user=o.user,s.action=n,o.ctx=s,s}},{key:"CreateToServiceInit",value:function(t){var n=new e(t);return n.provider="",n.app=t.$app,n}}]),e}();e.exports=f},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(1),s=n(0),a=(n(13),n(4)),u=n(2),c=n(48),l=n(77),d=void 0,f=function(e){o.warn("[Service warn]: "+e)},p=function(e){throw new Error("[Service warn]: "+e)},m=function(){function e(t,i,o){r(this,e);var c=this;t=t||{},c.$schema=t,c.$app=i,c.$db=o,d||(d=n(7)),t.settings||p("No settings of service '"+c.name+"'! Please create a settings object in service schema!");var m=u.defaultsDeep(t.settings,{version:1,namespace:"",internal:!1,rest:!1,ws:!1,graphql:!1,permission:a.PERM_LOGGEDIN,role:a.ROLE_USER,idParamName:"code",modelPropFilter:null});if(c.$settings=m,c.name=m.name,c.version=m.version,c.namespace=m.namespace,c.collection=m.collection,c.name||p("No name of service '"+c.name+"'! Please set in settings of service schema!"),!c.namespace&&(m.rest||m.ws||m.graphql)&&p("No namespace of service '"+c.name+"'! Please set in settings of service schema!"),s.cacheTimeout){var v=s.redis.enabled?"redis":"memory";c.$cacher=new l(v,c.name,s.cacheTimeout)}var h=function(e,t){return function(n){var r=c.getCacheKey(e.name,n.params);return c.getFromCache(r).then(function(e){return null!=e?e:t(n).then(function(e){return c.putToCache(r,e),e})})}};t.actions&&u.isObject(t.actions)&&(c.actions={},u.forIn(t.actions,function(e,t){if(u.isFunction(e)&&(e={handler:e,name:t}),u.isFunction(e.handler)){var n=e.handler.bind(c);e.cache&&(n=h(e,n)),c.actions[t]=n}c.actions[t].settings=e,c.actions[t].settings.name=c.actions[t].settings.name||t,delete c.actions[t].settings.handler})),t.methods&&u.isObject(t.methods)&&u.forIn(t.methods,function(e,t){return-1!=["name","version","namespace","collection","actions"].indexOf(t)?void f("Invalid method name '"+t+"' in '"+c.name+"' service! Skipping..."):-1!=["toJSON","getByID","modelResolver"].indexOf(t)?void f("This method name '"+t+"' is prohibited under 'methods' object. If you want to override the built-in method, please declare in the root of service schema! Skipping..."):void(c[t]=e.bind(c))}),["toJSON","getByID","modelResolver"].forEach(function(e){u.isFunction(t[e])&&(c["__"+e]=c[e],c[e]=t[e].bind(c))})}return i(e,[{key:"toJSON",value:function(e,t){var n=function(e){var n=e.toJSON();return null!=t?u.pick(n,t):n};return null==t&&(t=this.$settings.modelPropFilter),u.isString(t)&&(t=t.split(" ")),u.isArray(e)?u.map(e,function(e){return n(e)}):u.isObject(e)?n(e):void 0}},{key:"populateModels",value:function(e,t){if(t=t||this.$settings.modelPopulates,null!=e&&t){var n=[];if(u.forIn(t,function(t,r){if(u.isString(t)){var i=d.get(t);if(i&&u.isFunction(i.getByID)){(u.isArray(e)?e:[e]).forEach(function(e){n.push(i.getByID(e[r]).then(function(t){e[r]=t}))})}}}),n.length>0)return Promise.all(n).then(function(){return e})}return Promise.resolve(e)}},{key:"getByID",value:function(e){var t=this;if(null==this.collection||null==e)return Promise.resolve();if(u.isArray(e)&&0==e.length)return Promise.resolve([]);var n=s.cacheTimeout?this.getCacheKey("model",e):null;return Promise.resolve().then(function(){return n?t.getFromCache(n):null}).then(function(r){if(r)return r;var i=void 0;return i=u.isArray(e)?t.collection.find({_id:{$in:e}}):t.collection.findById(e),i.exec().then(function(e){return t.toJSON(e)}).then(function(e){return t.populateModels(e)}).then(function(e){return n&&t.putToCache(n,e),e})})}},{key:"modelResolver",value:function(e,t){if(null==this.collection)return Promise.resolve();var n=void 0;return n=u.isFunction(this.collection.schema.methods.decodeID)?this.collection.schema.methods.decodeID(t):t,e.modelID=n,null==n||""==n?e.errorBadRequest(a.ERR_INVALID_CODE,e.t("app:InvalidCode")):this.getByID(n)}},{key:"decodeID",value:function(e){if(u.isFunction(this.collection.schema.methods.decodeID))return this.collection.schema.methods.decodeID(e);throw new Error("'decodeID' method not implemented in '"+this.name+"' service!")}},{key:"encodeID",value:function(e){if(u.isFunction(this.collection.schema.methods.encodeID))return this.collection.schema.methods.encodeID(e);throw new Error("'encodeID' method not implemented in '"+this.name+"' service!")}},{key:"getCacheKey",value:function(e,t){return(e?e+":":"")+(t?c(t):"")}},{key:"getFromCache",value:function(e){return this.$cacher?this.$cacher.get(e):Promise.resolve(null)}},{key:"putToCache",value:function(e,t){return this.$cacher?this.$cacher.set(e,t):Promise.resolve()}},{key:"clearCache",value:function(){return this.$cacher?this.$cacher.clean():Promise.resolve()}},{key:"notifyModelChanges",value:function(e,t,n){e.notifyChanges(t,n,this.$settings.role),d.emit(this.name+":"+t,{ctx:e,payload:n}),this.clearCache()}},{key:"services",value:function(e){return d.get(e)}}]),e}();e.exports=m},function(e,t,n){"use strict";global.WEBPACK_BUNDLE=!1;var r=n(0),i=n(1),o=n(16),s=n(8);i.info(),i.info(s.bold("---------------------[ Server starting at %s ]---------------------------"),o().format("YYYY-MM-DD HH:mm:ss.SSS")),i.info(),i.info(s.bold("Application root path: ")+global.rootPath);var a=(n(50),n(15)()),u=n(49)(a);n(26);n(51),u.listen(r.port,r.ip,function(){i.info(""),i.info(r.app.title+" v"+r.app.version+" application started!"),i.info("----------------------------------------------"),i.info("Environment:\t"+s.underline.bold(process.env.NODE_ENV)),i.info("IP:\t\t"+r.ip),i.info("Port:\t\t"+r.port),i.info("Database:\t\t"+r.db.uri),i.info("Redis:\t\t"+(r.redis.enabled?r.redis.uri:"Disabled")),i.info(""),n(52)(),i.info("----------------------------------------------");var e=n(7);r.isDevMode&&e.printServicesInfo()}),e.exports=u},function(e,t,n){"use strict";function r(){var e={};return i.authKeys&&(i.authKeys.google&&i.authKeys.google.clientID&&(e.google=!0),i.authKeys.facebook&&i.authKeys.facebook.clientID&&(e.facebook=!0),i.authKeys.github&&i.authKeys.github.clientID&&(e.github=!0),i.authKeys.twitter&&i.authKeys.twitter.clientID&&(e.twitter=!0)),Object.keys(e).length>0?e:null}var i=n(0),o=n(1),s=n(4),a=n(14),u=n(24),c=n(36),l=(n(5),n(18),n(12)),d=n(30),f=n(3);e.exports=function(e,t){e.get("/login",function(e,t){if(null!=e.user)return t.redirect("/");t.render("account/login",{socialAuth:r()})}),e.get("/logout",function(e,t){e.logout(),e.session.destroy(),t.redirect("/")}),e.get("/signup",function(e,t){if(!0===i.features.disableSignUp)return t.redirect("/login");t.render("account/signup",{socialAuth:r()})}),e.post("/signup",function(e,t){if(!0===i.features.disableSignUp)return t.redirect("/");e.assert("name",e.t("NameCannotBeEmpty")).notEmpty(),e.assert("email",e.t("EmailCannotBeEmpty")).notEmpty(),e.assert("email",e.t("EmailIsNotValid")).isEmail(),e.sanitize("email").normalizeEmail({remove_dots:!1}),e.body.username||(e.body.username=e.body.email),e.sanitize("passwordless").toBoolean();var n=!0===e.body.passwordless;n||(e.assert("password",e.t("PasswordCannotBeEmpty")).notEmpty(),e.assert("password",e.t("PasswordTooShort")).len(6));var r=e.validationErrors();if(r)return e.flash("error",r),t.redirect("/signup");c.waterfall([function(e){i.features.verificationRequired?u.randomBytes(25,function(t,n){e(t,t?null:n.toString("hex"))}):e(null,null)},function(t,r){n?u.randomBytes(25,function(e,n){r(e,t,e?null:n.toString("hex"))}):r(null,t,e.body.password)},function(t,r,o){var a=new f({fullName:e.body.name,email:e.body.email,username:e.body.username,password:r,passwordLess:n,roles:[s.ROLE_USER],provider:"local"});t&&i.mailer.enabled?(a.verified=!1,a.verifyToken=t):a.verified=!0,a.save(function(t,n){if(t&&11e3===t.code){var r=t.message.split(".$")[1];r=r.split(" dup key")[0],r=r.substring(0,r.lastIndexOf("_")),"email"==r?e.flash("error",{msg:e.t("EmailIsExists")}):e.flash("error",{msg:e.t("UsernameIsExists")})}o(t,n)})},function(n,r){if(!i.mailer.enabled)return o.error("config.mailer not enabled; emailing skipped. Have you configured mailer yet?"),r(null,n);if(n.verified){var s=e.t("mailSubjectWelcome",i);t.render("mail/welcome",{name:n.fullName},function(e,t){if(e)return r(e);d.send(n.email,s,t,function(e,t){r(null,n)})})}else{var a=e.t("mailSubjectActivate",i);t.render("mail/accountVerify",{name:n.fullName,validateLink:"http://"+e.headers.host+"/verify/"+n.verifyToken},function(t,i){if(t)return r(t);d.send(n.email,a,i,function(t,i){t?e.flash("error",{msg:e.t("UnableToSendEmail",n)}):e.flash("info",{msg:e.t("emailSentVerifyLink")}),r(t,n)})})}}],function(n,r){if(n)return o.error(n),t.redirect("back");r.verified?e.login(r,function(e){return e&&o.error(e),t.redirect("/")}):t.redirect("/login")})}),e.get("/verify/:token",function(e,t){if(e.isAuthenticated())return t.redirect("/");c.waterfall([function(t){f.findOne({verifyToken:e.params.token}).exec(function(n,r){return n?t(n):r?(r.verified=!0,r.verifyToken=void 0,r.lastLogin=Date.now(),void r.save(function(n){if(n)return e.flash("error",{msg:e.t("UnableModifyAccountDetails")}),t(n);t(null,r)})):(e.flash("error",{msg:e.t("AccountVerificationExpired")}),t("Verification is invalid!"))})},function(n,r){if(!i.mailer.enabled){var s="Trying to send email without config.mailer enabled; emailing skipped. Have you configured mailer yet?";return o.error(s),r(s,n)}var a=e.t("mailSubjectWelcome",i);t.render("mail/welcome",{name:n.fullName},function(e,t){if(e)return r(e);d.send(n.email,a,t,function(e,t){r(null,n)})})},function(t,n){e.login(t,function(e){n(e,t)})}],function(e){if(e)return o.error(e),t.redirect("/signup");t.redirect("/")})}),e.get("/passwordless/:token",function(e,t){if(e.isAuthenticated())return t.redirect("/");c.waterfall([function(t){f.findOne({passwordLessToken:e.params.token}).exec(function(n,r){return n?t(n):r?(r.passwordLessToken=void 0,r.verified||(r.verified=!0,r.verifyToken=void 0),r.lastLogin=Date.now(),void r.save(function(n){if(n)return e.flash("error",{msg:e.t("UnableModifyAccountDetails")}),t(n);t(null,r)})):(e.flash("error",{msg:e.t("PasswordlessTokenExpired")}),t("Token is invalid!"))})},function(t,n){e.login(t,function(e){n(e,t)})}],function(e){if(e)return o.error(e),t.redirect("/login");t.redirect("/")})}),e.get("/forgot",function(e,t){if(e.isAuthenticated())return t.redirect("/");t.render("account/forgot")}),e.post("/forgot",function(e,t){e.assert("email",e.t("EmailIsNotValid")).isEmail(),e.assert("email",e.t("EmailCannotBeEmpty")).notEmpty(),e.sanitize("email").normalizeEmail({remove_dots:!1});var n=e.validationErrors();if(n)return e.flash("error",n),t.redirect("back");c.waterfall([function(e){u.randomBytes(25,function(t,n){e(t,t?null:n.toString("hex"))})},function(t,n){f.findOne({email:e.body.email},function(r,i){return i?1!==i.status?(e.flash("error",{msg:e.t("UserDisabledOrDeleted")}),n(e.t("UserDisabledOrDeleted"))):(i.resetPasswordToken=t,i.resetPasswordExpires=Date.now()+36e5,void i.save(function(e){n(e,t,i)})):(e.flash("error",{msg:e.t("EmailNotAssociatedToAccount",e.body)}),n("Email address "+e.body.email+" is not registered!"))})},function(n,r,s){if(!i.mailer.enabled){var a="Trying to send email without config.mailer enabled; emailing skipped. Have you configured mailer yet?";return o.error(a),s(a,r)}var u=e.t("mailSubjectResetPassword",i);t.render("mail/passwordReset",{name:r.fullName,resetLink:"http://"+e.headers.host+"/reset/"+n},function(t,n){if(t)return s(t);d.send(r.email,u,n,function(t,n){t?e.flash("error",{msg:e.t("UnableToSendEmail",r)}):e.flash("info",{msg:e.t("emailSentPasswordResetLink",r)}),s(t)})})}],function(e){e&&o.error(e),t.redirect("back")})}),e.get("/reset/:token",function(e,t,n){if(e.isAuthenticated())return t.redirect("/");f.findOne({resetPasswordToken:e.params.token}).where("resetPasswordExpires").gt(Date.now()).exec(function(r,i){return r?n(r):i?void t.render("account/reset"):(e.flash("error",{msg:e.t("PasswordResetTokenExpired")}),t.redirect("/forgot"))})}),e.post("/reset/:token",function(e,t,n){e.assert("password",e.t("PasswordTooShort")).len(6),e.assert("confirm",e.t("PasswordNotMatched")).equals(e.body.password);var r=e.validationErrors();if(r)return e.flash("error",r),t.redirect("back");c.waterfall([function(t){f.findOne({resetPasswordToken:e.params.token}).where("resetPasswordExpires").gt(Date.now()).exec(function(n,r){return n?t(n):r?(r.passwordLess&&(r.passwordLess=!1),r.password=e.body.password,r.resetPasswordToken=void 0,r.resetPasswordExpires=void 0,r.lastLogin=Date.now(),void r.save(function(n){if(n)return t(n);e.login(r,function(e){t(e,r)})})):(e.flash("error",{msg:e.t("PasswordResetTokenExpired")}),t("Password reset token is invalid or has expired."))})},function(n,r){if(!i.mailer.enabled){var s="Trying to send email without config.mailer enabled; emailing skipped. Have you configured mailer yet?";return o.error(s),r(s,n)}var a=e.t("mailSubjectPasswordChanged",i);t.render("mail/passwordChange",{name:n.fullName},function(t,i){if(t)return r(t);d.send(n.email,a,i,function(t,i){t?e.flash("error",{msg:e.t("UnableToSendEmail",n)}):e.flash("info",{msg:e.t("PasswordChanged")}),r(t)})})}],function(e){if(e)return o.error(e),t.redirect("back");t.redirect("/")})}),e.get("/generateAPIKey",function(e,t){if(!e.isAuthenticated())return l.json(t,null,l.UNAUTHORIZED);f.findById(e.user.id).exec(function(n,r){return n?l.json(t,null,l.SERVER_ERROR):r?(r.apiKey=a(),void r.save(function(e){return e?l.json(t,null,l.SERVER_ERROR):l.json(t,r)})):l.json(t,null,l.NOT_FOUND,e.t("InvalidUser"))})}),e.get("/unlink/:provider",function(e,t){return e.isAuthenticated()?e.params.provider&&-1!==["facebook","twitter","google","github"].indexOf(e.params.provider)?void f.findById(e.user.id).exec(function(n,r){return n?l.json(t,null,l.SERVER_ERROR):r?(r.socialLinks[e.params.provider]=void 0,void r.save(function(e){return e?l.json(t,null,l.SERVER_ERROR):l.json(t,r)})):l.json(t,null,l.NOT_FOUND,e.t("InvalidUser"))}):l.json(t,null,l.BAD_REQUEST,e.t("InvalidOAuthProvider")):l.json(t,null,l.UNAUTHORIZED)})}},function(e,t,n){"use strict";function r(e,t,n,r){if(e.accepts("json")&&!e.accepts("html")){var i=e.flash();if(i&&i.error&&i.error.length>0){var o=i.error[0].msg;f.json(t,null,r||f.REQUEST_FAILED,o)}else{var s="OK";i&&i.info&&i.info.length>0&&(s=i.info[0].msg),f.json(t,s)}}else n&&(e.session.returnTo&&(n=e.session.returnTo,delete e.session.returnTo),t.redirect(n))}var i=n(0),o=n(1),s=n(24),a=n(36),u=n(5),c=n(18),l=n(30),d=n(3),f=n(12);e.exports=function(e,t){var n=c.Router();n.post("/local",function(e,t,n){e.assert("username",e.t("UsernameCannotBeEmpty")).notEmpty();var c=e.validationErrors();if(c)return e.flash("error",c),r(e,t,"/login",f.BAD_REQUEST);e.body.password?u.authenticate("local",function(n,i,o){if(!i)return e.flash("error",{msg:o.message}),r(e,t,"/login");e.login(i,function(n){if(n)return e.flash("error",{msg:n}),r(e,t,"/login");e.user.lastLogin=Date.now(),e.user.save(function(){e.user.password=void 0,e.user.salt=void 0,r(e,t,"/")})})})(e,t,n):a.waterfall([function(e){s.randomBytes(25,function(t,n){e(t,t?null:n.toString("hex"))})},function(t,n){var r=e.body.username;d.findOne({$or:[{username:r},{email:r}]},function(i,o){return o?1!==o.status?(e.flash("error",{msg:e.t("UserDisabledOrDeleted")}),n("User '"+r+" is disabled or deleted!")):(o.passwordLessToken=t,void o.save(function(e){n(e,t,o)})):(e.flash("error",{msg:e.t("UsernameIsNotAssociated",{username:r})}),n("Invalid username or email: "+r))})},function(n,r,s){if(!i.mailer.enabled){var a="Trying to send email without config.mailer not enabled; emailing skipped. Have you configured mailer yet?";return o.error(a),s(a,r)}var u=e.t("mailSubjectLogin",i);t.render("mail/passwordLessLogin",{name:r.fullName,loginLink:"http://"+e.headers.host+"/passwordless/"+n},function(t,n){if(t)return s(t);l.send(r.email,u,n,function(t,n){t?e.flash("error",{msg:e.t("UnableToSendEmail",r)}):e.flash("info",{msg:e.t("emailSentWithMagicLink",r)}),s(t)})})}],function(n,i){n&&o.error(n),r(e,t,"back")})}),n.get("/google",u.authenticate("google",{scope:"profile email"})),n.get("/google/callback",u.authenticate("google",{failureRedirect:"/login"}),function(e,t){t.redirect("/")}),n.get("/facebook",u.authenticate("facebook",{scope:["email","user_location"]})),n.get("/facebook/callback",u.authenticate("facebook",{failureRedirect:"/login"}),function(e,t){t.redirect("/")}),n.get("/twitter",u.authenticate("twitter")),n.get("/twitter/callback",u.authenticate("twitter",{failureRedirect:"/login"}),function(e,t){t.redirect("/")}),n.get("/github",u.authenticate("github",{scope:"user:email"})),n.get("/github/callback",u.authenticate("github",{failureRedirect:"/login"}),function(e,t){t.redirect("/")}),e.use("/auth",n)}},function(e,t,n){"use strict";var r=n(0),i=n(1),o=n(12);e.exports=function(e,t){e.use(function(e,t,n,r){return e?(i.error(e.stack),n.status(e.status||500),t.accepts("html")?n.render("500",{url:t.originalUrl,error:e}):t.accepts("json")?o.json(n,null,o.SERVER_ERROR,e.message):void 0):r()}),e.use(function(e,t){if(t.status(404),r.isTestMode()||i.warn("404 error! URL:",e.url),e.accepts("html")){var n=new Error("404 Page Not Found");return n.status=404,t.render("404",{url:e.originalUrl,error:n})}if(e.accepts("json"))return o.json(t,null,o.NOT_FOUND)})}},function(e,t,n){"use strict";var r=n(0),i=n(1),o=(n(9),n(41).graphqlExpress),s=n(41).graphiqlExpress,a=n(112);e.exports=function(e,t){var u=n(7).registerGraphQLSchema();if(u){var c=a.makeExecutableSchema({typeDefs:u.schema,resolvers:u.resolvers,logger:r.isDevMode()?i:void 0});e.use("/graphql",o(function(e){var t=e.query.query||e.body.query;if(t&&t.length>2e3)throw new Error("Query too large.");return{schema:c,context:{req:e,query:t,t:e.t,user:e.user,session:e.session},debug:r.isDevMode(),formatError:function(e){return{status:e.originalError?e.originalError.status:400,type:e.originalError?e.originalError.type:null,message:e.message,locations:e.locations,path:e.path}}}})),e.use("/graphiql",s({endpointURL:"/graphql"}))}}},function(e,t,n){"use strict";n(0),n(1);e.exports=function(e,t){e.get("/health",function(e,t){t.sendStatus(200)})}},function(e,t,n){"use strict";n(0),n(1),n(6);e.exports=function(e,t){e.get("/",function(e,t){null!=e.user?t.render("main",{user:e.user}):t.render("index")}),n(85)(e,t),n(81)(e,t),n(82)(e,t),n(7).registerRoutes(e,t),n(84)(e,t),n(83)(e,t)}},function(e,t,n){"use strict";var r=n(1),i=n(0),o=(n(4),n(44)),s=n(45).htmlToText;e.exports={settings:{name:"mailer",internal:!0},methods:{send:function(e,t,a){return new Promise(function(u,c){r.info("Sending email to "+e+" with subject "+t+"...");var l={from:i.mailer.from,to:e,subject:t,html:a},d=void 0;if("smtp"==i.mailer.transport)d=o.createTransport(i.mailer.smtp);else if("mailgun"==i.mailer.transport){var f=n(46);d=o.createTransport(f({auth:{api_key:i.mailer.mailgun.apiKey,domain:i.mailer.mailgun.domain}}))}else if("sendgrid"==i.mailer.transport){var p=n(47);d=o.createTransport(p({auth:{api_key:i.mailer.sendgrid.apiKey}}))}d?(d.use("compile",s()),d.sendMail(l,function(e,t){e?(r.warn("Unable to send email: ",e),c(e)):(r.info("Email message sent.",t.response),u(t))})):c(new Error("Unable to send email! Invalid mailer transport: "+i.mailer.transport))})}},init:function(e){}}},function(e,t,n){"use strict";function r(e){return(0,o.default)(e,"Received null or undefined error."),{message:e.message,locations:e.locations,path:e.path}}Object.defineProperty(t,"__esModule",{value:!0}),t.formatError=r;var i=n(91),o=function(e){return e&&e.__esModule?e:{default:e}}(i)},function(e,t,n){"use strict";function r(e,t,n){if(e&&e.path)return e;var r=e?e.message||String(e):"An unknown error occurred.";return new i.GraphQLError(r,e&&e.nodes||t,e&&e.source,e&&e.positions,n,e)}Object.defineProperty(t,"__esModule",{value:!0}),t.locatedError=r;var i=n(21)},function(e,t,n){"use strict";function r(e,t,n){var r=(0,s.getLocation)(e,t);return new a.GraphQLError("Syntax Error "+e.name+" ("+r.line+":"+r.column+") "+n+"\n\n"+i(e,r),void 0,e,[t])}function i(e,t){var n=t.line,r=(n-1).toString(),i=n.toString(),s=(n+1).toString(),a=s.length,u=e.body.split(/\r\n|[\n\r]/g);return(n>=2?o(a,r)+": "+u[n-2]+"\n":"")+o(a,i)+": "+u[n-1]+"\n"+Array(2+a+t.column).join(" ")+"^\n"+(n<u.length?o(a,s)+": "+u[n]+"\n":"")}function o(e,t){return Array(e-t.length+1).join(" ")+t}Object.defineProperty(t,"__esModule",{value:!0}),t.syntaxError=r;var s=n(22),a=n(21)},function(e,t,n){"use strict";function r(e,t){if(!e)throw new Error(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BREAK=t.getVisitFn=t.visitWithTypeInfo=t.visitInParallel=t.visit=t.Source=t.print=t.parseType=t.parseValue=t.parse=t.TokenKind=t.createLexer=t.Kind=t.getLocation=void 0;var r=n(22);Object.defineProperty(t,"getLocation",{enumerable:!0,get:function(){return r.getLocation}});var i=n(33);Object.defineProperty(t,"createLexer",{enumerable:!0,get:function(){return i.createLexer}}),Object.defineProperty(t,"TokenKind",{enumerable:!0,get:function(){return i.TokenKind}});var o=n(93);Object.defineProperty(t,"parse",{enumerable:!0,get:function(){return o.parse}}),Object.defineProperty(t,"parseValue",{enumerable:!0,get:function(){return o.parseValue}}),Object.defineProperty(t,"parseType",{enumerable:!0,get:function(){return o.parseType}});var s=n(94);Object.defineProperty(t,"print",{enumerable:!0,get:function(){return s.print}});var a=n(34);Object.defineProperty(t,"Source",{enumerable:!0,get:function(){return a.Source}});var u=n(35);Object.defineProperty(t,"visit",{enumerable:!0,get:function(){return u.visit}}),Object.defineProperty(t,"visitInParallel",{enumerable:!0,get:function(){return u.visitInParallel}}),Object.defineProperty(t,"visitWithTypeInfo",{enumerable:!0,get:function(){return u.visitWithTypeInfo}}),Object.defineProperty(t,"getVisitFn",{enumerable:!0,get:function(){return u.getVisitFn}}),Object.defineProperty(t,"BREAK",{enumerable:!0,get:function(){return u.BREAK}});var c=n(32),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(c);t.Kind=l},function(e,t,n){"use strict";function r(e,t){var n="string"==typeof e?new oe.Source(e):e;return a((0,ae.createLexer)(n,t||{}))}function i(e,t){var n="string"==typeof e?new oe.Source(e):e,r=(0,ae.createLexer)(n,t||{});ee(r,ae.TokenKind.SOF);var i=T(r,!1);return ee(r,ae.TokenKind.EOF),i}function o(e,t){var n="string"==typeof e?new oe.Source(e):e,r=(0,ae.createLexer)(n,t||{});ee(r,ae.TokenKind.SOF);var i=P(r);return ee(r,ae.TokenKind.EOF),i}function s(e){var t=ee(e,ae.TokenKind.NAME);return{kind:ue.NAME,value:t.value,loc:H(e,t)}}function a(e){var t=e.token;ee(e,ae.TokenKind.SOF);var n=[];do{n.push(u(e))}while(!X(e,ae.TokenKind.EOF));return{kind:ue.DOCUMENT,definitions:n,loc:H(e,t)}}function u(e){if(Z(e,ae.TokenKind.BRACE_L))return c(e);if(Z(e,ae.TokenKind.NAME))switch(e.token.value){case"query":case"mutation":case"subscription":return c(e);case"fragment":return k(e);case"schema":case"scalar":case"type":case"interface":case"union":case"enum":case"input":case"extend":case"directive":return _(e)}throw ne(e)}function c(e){var t=e.token;if(Z(e,ae.TokenKind.BRACE_L))return{kind:ue.OPERATION_DEFINITION,operation:"query",name:null,variableDefinitions:null,directives:[],selectionSet:m(e),loc:H(e,t)};var n=l(e),r=void 0;return Z(e,ae.TokenKind.NAME)&&(r=s(e)),{kind:ue.OPERATION_DEFINITION,operation:n,name:r,variableDefinitions:d(e),directives:x(e),selectionSet:m(e),loc:H(e,t)}}function l(e){var t=ee(e,ae.TokenKind.NAME);switch(t.value){case"query":return"query";case"mutation":return"mutation";case"subscription":return"subscription"}throw ne(e,t)}function d(e){return Z(e,ae.TokenKind.PAREN_L)?ie(e,ae.TokenKind.PAREN_L,f,ae.TokenKind.PAREN_R):[]}function f(e){var t=e.token;return{kind:ue.VARIABLE_DEFINITION,variable:p(e),type:(ee(e,ae.TokenKind.COLON),P(e)),defaultValue:X(e,ae.TokenKind.EQUALS)?T(e,!0):null,loc:H(e,t)}}function p(e){var t=e.token;return ee(e,ae.TokenKind.DOLLAR),{kind:ue.VARIABLE,name:s(e),loc:H(e,t)}}function m(e){var t=e.token;return{kind:ue.SELECTION_SET,selections:ie(e,ae.TokenKind.BRACE_L,v,ae.TokenKind.BRACE_R),loc:H(e,t)}}function v(e){return Z(e,ae.TokenKind.SPREAD)?E(e):h(e)}function h(e){var t=e.token,n=s(e),r=void 0,i=void 0;return X(e,ae.TokenKind.COLON)?(r=n,i=s(e)):(r=null,i=n),{kind:ue.FIELD,alias:r,name:i,arguments:g(e),directives:x(e),selectionSet:Z(e,ae.TokenKind.BRACE_L)?m(e):null,loc:H(e,t)}}function g(e){return Z(e,ae.TokenKind.PAREN_L)?ie(e,ae.TokenKind.PAREN_L,y,ae.TokenKind.PAREN_R):[]}function y(e){var t=e.token;return{kind:ue.ARGUMENT,name:s(e),value:(ee(e,ae.TokenKind.COLON),T(e,!1)),loc:H(e,t)}}function E(e){var t=e.token;if(ee(e,ae.TokenKind.SPREAD),Z(e,ae.TokenKind.NAME)&&"on"!==e.token.value)return{kind:ue.FRAGMENT_SPREAD,name:b(e),directives:x(e),loc:H(e,t)};var n=null;return"on"===e.token.value&&(e.advance(),n=R(e)),{kind:ue.INLINE_FRAGMENT,typeCondition:n,directives:x(e),selectionSet:m(e),loc:H(e,t)}}function k(e){var t=e.token;return te(e,"fragment"),{kind:ue.FRAGMENT_DEFINITION,name:b(e),typeCondition:(te(e,"on"),R(e)),directives:x(e),selectionSet:m(e),loc:H(e,t)}}function b(e){if("on"===e.token.value)throw ne(e);return s(e)}function T(e,t){var n=e.token;switch(n.kind){case ae.TokenKind.BRACKET_L:return I(e,t);case ae.TokenKind.BRACE_L:return N(e,t);case ae.TokenKind.INT:return e.advance(),{kind:ue.INT,value:n.value,loc:H(e,n)};case ae.TokenKind.FLOAT:return e.advance(),{kind:ue.FLOAT,value:n.value,loc:H(e,n)};case ae.TokenKind.STRING:return e.advance(),{kind:ue.STRING,value:n.value,loc:H(e,n)};case ae.TokenKind.NAME:return"true"===n.value||"false"===n.value?(e.advance(),{kind:ue.BOOLEAN,value:"true"===n.value,loc:H(e,n)}):"null"===n.value?(e.advance(),{kind:ue.NULL,loc:H(e,n)}):(e.advance(),{kind:ue.ENUM,value:n.value,loc:H(e,n)});case ae.TokenKind.DOLLAR:if(!t)return p(e)}throw ne(e)}function w(e){return T(e,!0)}function S(e){return T(e,!1)}function I(e,t){var n=e.token,r=t?w:S;return{kind:ue.LIST,values:re(e,ae.TokenKind.BRACKET_L,r,ae.TokenKind.BRACKET_R),loc:H(e,n)}}function N(e,t){var n=e.token;ee(e,ae.TokenKind.BRACE_L);for(var r=[];!X(e,ae.TokenKind.BRACE_R);)r.push(O(e,t));return{kind:ue.OBJECT,fields:r,loc:H(e,n)}}function O(e,t){var n=e.token;return{kind:ue.OBJECT_FIELD,name:s(e),value:(ee(e,ae.TokenKind.COLON),T(e,t)),loc:H(e,n)}}function x(e){for(var t=[];Z(e,ae.TokenKind.AT);)t.push(D(e));return t}function D(e){var t=e.token;return ee(e,ae.TokenKind.AT),{kind:ue.DIRECTIVE,name:s(e),arguments:g(e),loc:H(e,t)}}function P(e){var t=e.token,n=void 0;return X(e,ae.TokenKind.BRACKET_L)?(n=P(e),ee(e,ae.TokenKind.BRACKET_R),n={kind:ue.LIST_TYPE,type:n,loc:H(e,t)}):n=R(e),X(e,ae.TokenKind.BANG)?{kind:ue.NON_NULL_TYPE,type:n,loc:H(e,t)}:n}function R(e){var t=e.token;return{kind:ue.NAMED_TYPE,name:s(e),loc:H(e,t)}}function _(e){if(Z(e,ae.TokenKind.NAME))switch(e.token.value){case"schema":return A(e);case"scalar":return q(e);case"type":return j(e);case"interface":return K(e);case"union":return B(e);case"enum":return G(e);case"input":return $(e);case"extend":return J(e);case"directive":return Q(e)}throw ne(e)}function A(e){var t=e.token;te(e,"schema");var n=x(e),r=ie(e,ae.TokenKind.BRACE_L,L,ae.TokenKind.BRACE_R);return{kind:ue.SCHEMA_DEFINITION,directives:n,operationTypes:r,loc:H(e,t)}}function L(e){var t=e.token,n=l(e);ee(e,ae.TokenKind.COLON);var r=R(e);return{kind:ue.OPERATION_TYPE_DEFINITION,operation:n,type:r,loc:H(e,t)}}function q(e){var t=e.token;te(e,"scalar");var n=s(e),r=x(e);return{kind:ue.SCALAR_TYPE_DEFINITION,name:n,directives:r,loc:H(e,t)}}function j(e){var t=e.token;te(e,"type");var n=s(e),r=C(e),i=x(e),o=re(e,ae.TokenKind.BRACE_L,M,ae.TokenKind.BRACE_R);return{kind:ue.OBJECT_TYPE_DEFINITION,name:n,interfaces:r,directives:i,fields:o,loc:H(e,t)}}function C(e){var t=[];if("implements"===e.token.value){e.advance();do{t.push(R(e))}while(Z(e,ae.TokenKind.NAME))}return t}function M(e){var t=e.token,n=s(e),r=U(e);ee(e,ae.TokenKind.COLON);var i=P(e),o=x(e);return{kind:ue.FIELD_DEFINITION,name:n,arguments:r,type:i,directives:o,loc:H(e,t)}}function U(e){return Z(e,ae.TokenKind.PAREN_L)?ie(e,ae.TokenKind.PAREN_L,F,ae.TokenKind.PAREN_R):[]}function F(e){var t=e.token,n=s(e);ee(e,ae.TokenKind.COLON);var r=P(e),i=null;X(e,ae.TokenKind.EQUALS)&&(i=w(e));var o=x(e);return{kind:ue.INPUT_VALUE_DEFINITION,name:n,type:r,defaultValue:i,directives:o,loc:H(e,t)}}function K(e){var t=e.token;te(e,"interface");var n=s(e),r=x(e),i=re(e,ae.TokenKind.BRACE_L,M,ae.TokenKind.BRACE_R);return{kind:ue.INTERFACE_TYPE_DEFINITION,name:n,directives:r,fields:i,loc:H(e,t)}}function B(e){var t=e.token;te(e,"union");var n=s(e),r=x(e);ee(e,ae.TokenKind.EQUALS);var i=V(e);return{kind:ue.UNION_TYPE_DEFINITION,name:n,directives:r,types:i,loc:H(e,t)}}function V(e){var t=[];do{t.push(R(e))}while(X(e,ae.TokenKind.PIPE));return t}function G(e){var t=e.token;te(e,"enum");var n=s(e),r=x(e),i=ie(e,ae.TokenKind.BRACE_L,Y,ae.TokenKind.BRACE_R);return{kind:ue.ENUM_TYPE_DEFINITION,name:n,directives:r,values:i,loc:H(e,t)}}function Y(e){var t=e.token,n=s(e),r=x(e);return{kind:ue.ENUM_VALUE_DEFINITION,name:n,directives:r,loc:H(e,t)}}function $(e){var t=e.token;te(e,"input");var n=s(e),r=x(e),i=re(e,ae.TokenKind.BRACE_L,F,ae.TokenKind.BRACE_R);return{kind:ue.INPUT_OBJECT_TYPE_DEFINITION,name:n,directives:r,fields:i,loc:H(e,t)}}function J(e){var t=e.token;te(e,"extend");var n=j(e);return{kind:ue.TYPE_EXTENSION_DEFINITION,definition:n,loc:H(e,t)}}function Q(e){var t=e.token;te(e,"directive"),ee(e,ae.TokenKind.AT);var n=s(e),r=U(e);te(e,"on");var i=z(e);return{kind:ue.DIRECTIVE_DEFINITION,name:n,arguments:r,locations:i,loc:H(e,t)}}function z(e){var t=[];do{t.push(s(e))}while(X(e,ae.TokenKind.PIPE));return t}function H(e,t){if(!e.options.noLocation)return new W(t,e.lastToken,e.source)}function W(e,t,n){this.start=e.start,this.end=t.end,this.startToken=e,this.endToken=t,this.source=n}function Z(e,t){return e.token.kind===t}function X(e,t){var n=e.token.kind===t;return n&&e.advance(),n}function ee(e,t){var n=e.token;if(n.kind===t)return e.advance(),n;throw(0,se.syntaxError)(e.source,n.start,"Expected "+t+", found "+(0,ae.getTokenDesc)(n))}function te(e,t){var n=e.token;if(n.kind===ae.TokenKind.NAME&&n.value===t)return e.advance(),n;throw(0,se.syntaxError)(e.source,n.start,'Expected "'+t+'", found '+(0,ae.getTokenDesc)(n))}function ne(e,t){var n=t||e.token;return(0,se.syntaxError)(e.source,n.start,"Unexpected "+(0,ae.getTokenDesc)(n))}function re(e,t,n,r){ee(e,t);for(var i=[];!X(e,r);)i.push(n(e));return i}function ie(e,t,n,r){ee(e,t);for(var i=[n(e)];!X(e,r);)i.push(n(e));return i}Object.defineProperty(t,"__esModule",{value:!0}),t.parse=r,t.parseValue=i,t.parseType=o,t.parseConstValue=w,t.parseTypeReference=P,t.parseNamedType=R;var oe=n(34),se=n(31),ae=n(33),ue=n(32);W.prototype.toJSON=W.prototype.inspect=function(){return{start:this.start,end:this.end}}},function(e,t,n){"use strict";function r(e){return(0,u.visit)(e,{leave:c})}function i(e,t){return e?e.filter(function(e){return e}).join(t||""):""}function o(e){return e&&0!==e.length?a("{\n"+i(e,"\n"))+"\n}":"{}"}function s(e,t,n){return t?e+t+(n||""):""}function a(e){return e&&e.replace(/\n/g,"\n  ")}Object.defineProperty(t,"__esModule",{value:!0}),t.print=r;var u=n(35),c={Name:function(e){return e.value},Variable:function(e){return"$"+e.name},Document:function(e){return i(e.definitions,"\n\n")+"\n"},OperationDefinition:function(e){var t=e.operation,n=e.name,r=s("(",i(e.variableDefinitions,", "),")"),o=i(e.directives," "),a=e.selectionSet;return n||o||r||"query"!==t?i([t,i([n,r]),o,a]," "):a},VariableDefinition:function(e){return e.variable+": "+e.type+s(" = ",e.defaultValue)},SelectionSet:function(e){return o(e.selections)},Field:function(e){var t=e.alias,n=e.name,r=e.arguments,o=e.directives,a=e.selectionSet;return i([s("",t,": ")+n+s("(",i(r,", "),")"),i(o," "),a]," ")},Argument:function(e){return e.name+": "+e.value},FragmentSpread:function(e){return"..."+e.name+s(" ",i(e.directives," "))},InlineFragment:function(e){var t=e.typeCondition,n=e.directives,r=e.selectionSet;return i(["...",s("on ",t),i(n," "),r]," ")},FragmentDefinition:function(e){var t=e.name,n=e.typeCondition,r=e.directives,o=e.selectionSet;return"fragment "+t+" on "+n+" "+s("",i(r," ")," ")+o},IntValue:function(e){return e.value},FloatValue:function(e){return e.value},StringValue:function(e){var t=e.value;return JSON.stringify(t)},BooleanValue:function(e){var t=e.value;return JSON.stringify(t)},NullValue:function(){return"null"},EnumValue:function(e){return e.value},ListValue:function(e){return"["+i(e.values,", ")+"]"},ObjectValue:function(e){return"{"+i(e.fields,", ")+"}"},ObjectField:function(e){return e.name+": "+e.value},Directive:function(e){return"@"+e.name+s("(",i(e.arguments,", "),")")},NamedType:function(e){return e.name},ListType:function(e){return"["+e.type+"]"},NonNullType:function(e){return e.type+"!"},SchemaDefinition:function(e){var t=e.directives,n=e.operationTypes;return i(["schema",i(t," "),o(n)]," ")},OperationTypeDefinition:function(e){return e.operation+": "+e.type},ScalarTypeDefinition:function(e){return i(["scalar",e.name,i(e.directives," ")]," ")},ObjectTypeDefinition:function(e){var t=e.name,n=e.interfaces,r=e.directives,a=e.fields;return i(["type",t,s("implements ",i(n,", ")),i(r," "),o(a)]," ")},FieldDefinition:function(e){var t=e.name,n=e.arguments,r=e.type,o=e.directives;return t+s("(",i(n,", "),")")+": "+r+s(" ",i(o," "))},InputValueDefinition:function(e){var t=e.name,n=e.type,r=e.defaultValue,o=e.directives;return i([t+": "+n,s("= ",r),i(o," ")]," ")},InterfaceTypeDefinition:function(e){var t=e.name,n=e.directives,r=e.fields;return i(["interface",t,i(n," "),o(r)]," ")},UnionTypeDefinition:function(e){var t=e.name,n=e.directives,r=e.types;return i(["union",t,i(n," "),"= "+i(r," | ")]," ")},EnumTypeDefinition:function(e){var t=e.name,n=e.directives,r=e.values;return i(["enum",t,i(n," "),o(r)]," ")},EnumValueDefinition:function(e){return i([e.name,i(e.directives," ")]," ")},InputObjectTypeDefinition:function(e){var t=e.name,n=e.directives,r=e.fields;return i(["input",t,i(n," "),o(r)]," ")},TypeExtensionDefinition:function(e){return"extend "+e.definition},DirectiveDefinition:function(e){var t=e.name,n=e.arguments,r=e.locations;return"directive @"+t+s("(",i(n,", "),")")+" on "+i(r," | ")}}},function(e,t){e.exports='"use strict";\n\nvar path = require("path");\nvar pkg = require("./package.json");\n\nmodule.exports = {\n\thashSecret: "{{hashSecret}}",\n\n\tsessionSecret: "{{sessionSecret}}",\n\n\tapp: {},\n\n\tdb: {\n\t\toptions: {\n\t\t\tuser: process.env.MONGO_USERNAME || "",\n\t\t\tpass: process.env.MONGO_PASSWORD || ""\n\t\t}\n\t},\n\n\tredis: {\n\t\tenabled: false,\n\t\turi: process.env.REDIS_URI || "redis://localhost:6379",\n\t\toptions: null\n\t},\n\n\tmailer: {},\n\n\tfeatures: {\n\t\tdisableSignUp: false,\n\t\tverificationRequired: true\n\t},\n\n\tauthKeys: {\n\n\t\tgoogle: {\n\t\t\tclientID: null,\n\t\t\tclientSecret: null\n\t\t},\n\n\t\tfacebook: {\n\t\t\tclientID: null,\n\t\t\tclientSecret: null\n\t\t},\n\n\t\tgithub: {\n\t\t\tclientID: null,\n\t\t\tclientSecret: null\n\t\t},\n\n\t\ttwitter: {\n\t\t\tclientID: null,\n\t\t\tclientSecret: null\n\t\t}\n\t},\n\n\tlogging: {\n\n\t\tconsole: {},\n\n\t\tfile: {\n\t\t\tenabled: false\n\t\t},\n\n\t\tgraylog: {\n\t\t\tenabled: false\n\t\t},\n\n\t\tpapertrail: {\n\t\t\tenabled: false,\n\t\t\thost: null,\n\t\t\tport: null,\n\t\t\tlevel: "debug",\n\t\t\tprogram: "vem"\n\t\t},\n\n\t\tlogentries: {\n\t\t\tenabled: false,\n\t\t\ttoken: null\n\t\t},\n\n\t\tloggly: {\n\t\t\tenabled: false,\n\t\t\ttoken: null,\n\t\t\tsubdomain: null\n\t\t},\n\n\t\tlogsene: {\n\t\t\tenabled: false,\n\t\t\ttoken: null\n\t\t},\n\n\t\tlogzio: {\n\t\t\tenabled: false,\n\t\t\ttoken: null\n\t\t}\n\n\t}\n\n};'},function(e,t,n){function r(e){return n(i(e))}function i(e){var t=o[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var o={"./counter/service.js":57,"./devices/service.js":58,"./persons/service.js":60,"./posts/service.js":61,"./profile/service.js":63,"./session/service.js":64};r.keys=function(){return Object.keys(o)},r.resolve=i,e.exports=r,r.id=96},function(e,t,n){function r(e){return n(i(e))}function i(e){var t=o[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var o={"./apikey.js":69,"./facebook.js":70,"./github.js":71,"./google.js":72,"./local.js":73,"./twitter.js":74};r.keys=function(){return Object.keys(o)},r.resolve=i,e.exports=r,r.id=97},function(e,t,n){function r(e){return n(i(e))}function i(e){var t=o[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var o={"./mailer.js":87};r.keys=function(){return Object.keys(o)},r.resolve=i,e.exports=r,r.id=98},function(e,t){e.exports=require("../config.js")},function(e,t){e.exports=require("agenda")},function(e,t){e.exports=require("bcrypt-nodejs")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("cli-table2")},function(e,t){e.exports=require("clui")},function(e,t){e.exports=require("compression")},function(e,t){e.exports=require("csurf")},function(e,t){e.exports=require("events")},function(e,t){e.exports=require("express-flash")},function(e,t){e.exports=require("express-list-endpoints")},function(e,t){e.exports=require("express-validator")},function(e,t){e.exports=require("graphql")},function(e,t){e.exports=require("graphql-tools")},function(e,t){e.exports=require("hashids")},function(e,t){e.exports=require("helmet")},function(e,t){e.exports=require("helmet-crossdomain")},function(e,t){e.exports=require("i18next")},function(e,t){e.exports=require("i18next-express-middleware")},function(e,t){e.exports=require("i18next-node-fs-backend")},function(e,t){e.exports=require("ioredis")},function(e,t){e.exports=require("le_node")},function(e,t){e.exports=require("method-override")},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=require("netjet")},function(e,t){e.exports=require("os")},function(e,t){e.exports=require("passport-facebook")},function(e,t){e.exports=require("passport-github")},function(e,t){e.exports=require("passport-google-oauth")},function(e,t){e.exports=require("passport-local")},function(e,t){e.exports=require("passport-localapikey-update")},function(e,t){e.exports=require("passport-twitter")},function(e,t){e.exports=require("pretty-bytes")},function(e,t){e.exports=require("serve-favicon")},function(e,t){e.exports=require("socket.io")},function(e,t){e.exports=require("stream")},function(e,t){e.exports=require("util")},function(e,t){e.exports=require("uuid-token-generator")},function(e,t){e.exports=require("webpack-dev-middleware")},function(e,t){e.exports=require("webpack-hot-middleware")},function(e,t){e.exports=require("webpack-merge")},function(e,t){e.exports=require("winston")},function(e,t){e.exports=require("winston-daily-rotate-file")},function(e,t){e.exports=require("winston-graylog2")},function(e,t){e.exports=require("winston-loggly-bulk")},function(e,t){e.exports=require("winston-logsene")},function(e,t){e.exports=require("winston-logzio")},function(e,t){e.exports=require("winston-papertrail")}]);